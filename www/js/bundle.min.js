function Keyboard(e){this.el=document.querySelectorAll("main")[0],this.canvas=document.getElementsByTagName("canvas")[0],paper.setup(this.canvas),this.attachEvents(),this.keyboard=void 0,this.keyMap=void 0,this.path=new paper.Path,this.graphics=void 0,this.type=void 0,this.text=[],this.debug={center:void 0,boundingBox:void 0},paper.project.importSVG("../data/keyboard.svg",{onLoad:this.initKeyboard.bind(this),onError:this.onErr.bind(this)}),paper.view.zoom=.5}var Loader={queue:void 0,init:function(){this.queue=new createjs.LoadQueue,this.queue.on("complete",this.onLoadCompleted),this.queue.on("error",this.onLoadError),this.queue.on("progress",this.onLoadProgress)},load:function(e,t){console.log("Loading:",e[0].src);var o=this.queue;o.on("complete",t),o.loadManifest(e)},getContentById:function(e){return this.queue.getResult(e)},onLoadCompleted:function(){console.log("Load Completed")},onLoadError:function(){console.log("Load Error")},onLoadProgress:function(){console.log(".")}},App={container:void 0,init:function(e){this.container=e,Loader.init(),this.initialLoad()},initialLoad:function(){Loader.load([{id:"homepage",src:"data/homepage.html"}],this.loadCompleted.bind(this))},loadCompleted:function(){this.container.innerHTML=Loader.getContentById("homepage"),this.initialTransitionIn()},initialTransitionIn:function(){this.container.classList.add("fade-in"),console.log("[PAN] ☑️"),Keyboard=new Keyboard},dispose:function(){this.container.innerHTML=""}};Keyboard.prototype.onErr=function(e){console.log(e)},Keyboard.prototype.attachEvents=function(){window.addEventListener("keydown",function(e){this.onKeyDown(e.key.toLowerCase(),e.location),e.preventDefault()}.bind(this)),window.addEventListener("keyup",function(e){this.onKeyUp(e.key.toLowerCase(),e.location),e.preventDefault()}.bind(this)),window.addEventListener("resize",function(e){this.resize()}.bind(this))},Keyboard.prototype.resize=function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.style="",paper.view.viewSize=new paper.Size(window.innerWidth,window.innerHeight),this.debug.center.position=paper.view.center,this.debug.boundingBox.position=paper.view.center,this.graphics.position=paper.view.center,paper.view.draw()},Keyboard.prototype.initKeyboard=function(e,t){console.log("Imported!"),this.debug.center=new paper.Shape.Circle(new paper.Point(80,50),2),this.debug.center.fillColor="red",this.keyboard=e.children[0],this.keyboard.style={fillColor:"#808080",strokeColor:new paper.Color(1,1,1,.4),strokeWidth:1.5,shadowColor:new paper.Color(0,0,0,.45),shadowBlur:4,shadowOffset:new paper.Point(0,2)},this.debug.boundingBox=new paper.Path.Rectangle(this.keyboard.bounds);for(var o=this.keyboard.children.length-1;o>=0;o--)this.keyboard.children[o].strokeColor=new paper.Color(Math.random(),Math.random(),Math.random()),this.keyboard.children[o].strokeColor={gradient:{stops:[new paper.Color(1,1,1,.3),new paper.Color(1,1,1,.2)]},origin:this.keyboard.children[o].bounds.topCenter,destination:this.keyboard.children[o].bounds.bottomCenter};this.keyMap=["1","`","2","3","4","5","6","7","8","9","0","-","=","q","w","e","r","t","y","u","i","o","p","[","]","\\","a","s","d","f","g","h","j","k","l",";","'","z","x","c","v","b","n","m",",",".","/","backspace","tab","capslock","shift"," ","//meta","control","//alt","alt","//control","meta","//shift","enter"];var i=new paper.Raster("return");i.position.x=this.keyboard.children[59].bounds.bottomRight.x-i.width/2-12,i.position.y=this.keyboard.children[59].bounds.bottomRight.y-i.height/2-12;var n=new paper.Raster("del");n.position.x=this.keyboard.children[47].bounds.bottomRight.x-n.width/2-12,n.position.y=this.keyboard.children[47].bounds.bottomRight.y-n.height/2-12,this.type=new paper.Group([i,n]),this.initPath(),this.resize()},Keyboard.prototype.initPath=function(){this.path.style={strokeWidth:6,fillColor:new paper.Color(0,0,0,0),strokeCap:"round",strokeJoin:"round"},this.path.strokeColor={gradient:{stops:[new paper.Color("#00FFF4"),new paper.Color("#1F00FF")]},origin:this.debug.boundingBox.bounds.leftCenter,destination:this.debug.boundingBox.bounds.rightCenter},this.graphics=new paper.Group([this.keyboard,this.path,this.type]),this.graphics.bringToFront()},Keyboard.prototype.locateKey=function(e,t){var o=null;if(1==t||0==t){for(var i=this.keyMap.length-1;i>=0;i--)this.keyMap[i]==e&&(o=i);null==o&&console.log("No match")}else 2==t&&("meta"==e&&(o=52),"alt"==e&&(o=54),"control"==e&&(o=56),"shift"==e&&(o=58));return o},Keyboard.prototype.onKeyDown=function(e,t){var o=this.locateKey(e,t);return this.keyboard.children[o].shadowColor=new paper.Color(0,0,0,.2),this.keyboard.children[o].shadowBlur=1,this.keyboard.children[o].shadowOffset=new paper.Point(0,1),"backspace"==e?void this["delete"]():"enter"==e?void paper.view.draw():(this.addToText(e),void this.addToPath(o))},Keyboard.prototype.onKeyUp=function(e,t){for(var o=this.keyboard.children.length-1;o>=0;o--)this.keyboard.children[o].shadowColor=new paper.Color(0,0,0,.45),this.keyboard.children[o].shadowBlur=4,this.keyboard.children[o].shadowOffset=new paper.Point(0,2);"enter"==e&&this.path.segments.length>1&&(this.sendToPrinter(),this.resetAll()),paper.view.draw()},Keyboard.prototype.addToPath=function(e){this.path.add(this.keyboard.children[e].bounds.center),this.path.smooth(),paper.view.draw()},Keyboard.prototype.addToText=function(e){this.text.push(e)},Keyboard.prototype["delete"]=function(){this.path.removeSegment(this.path.segments.length-1),this.text.pop(),paper.view.draw()},Keyboard.prototype.sendToPrinter=function(){var e=new paper.Path.Rectangle(paper.view.bounds),t=this.path.clone();e.fillColor="white",e.sendToBack(),t.bringToFront(),t.strokeColor="black",t.strokeWidth=25;for(var o=this.text.length-1;o>=0;o--)("meta"==this.text[o]||"control"==this.text[o]||"alt"==this.text[o]||"shift"==this.text[o]||"tab"==this.text[o]||"capslock"==this.text[o])&&(this.text[o]="░");var i=(new paper.Group([e,t]),'<?xml version="1.0" encoding="utf-8"?>');i+="<svg>",i+=this.path.exportSVG({asString:!0}),i+="</svg>";var n=new Blob([i],{type:"data:image/svg+xml"});saveAs(n,"test.svg"),e.remove(),t.remove()},Keyboard.prototype.resetAll=function(){this.path.removeSegments(),this.text=[]},document.addEventListener("DOMContentLoaded",function(){console.log("👻"),App.init(document.getElementById("container"))});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIktleWJvYXJkLmpzIiwibG9hZGVyLmpzIiwiYXBwLmpzIiwiaW5kZXguanMiXSwibmFtZXMiOlsiS2V5Ym9hcmQiLCJwYXJhbWV0ZXJzIiwidGhpcyIsImVsIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiY2FudmFzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXBlciIsInNldHVwIiwiYXR0YWNoRXZlbnRzIiwia2V5Ym9hcmQiLCJ1bmRlZmluZWQiLCJrZXlNYXAiLCJwYXRoIiwiUGF0aCIsImdyYXBoaWNzIiwidHlwZSIsInRleHQiLCJkZWJ1ZyIsImNlbnRlciIsImJvdW5kaW5nQm94IiwicHJvamVjdCIsImltcG9ydFNWRyIsIm9uTG9hZCIsImluaXRLZXlib2FyZCIsImJpbmQiLCJvbkVycm9yIiwib25FcnIiLCJ2aWV3Iiwiem9vbSIsIkxvYWRlciIsInF1ZXVlIiwiaW5pdCIsImNyZWF0ZWpzIiwiTG9hZFF1ZXVlIiwib24iLCJvbkxvYWRDb21wbGV0ZWQiLCJvbkxvYWRFcnJvciIsIm9uTG9hZFByb2dyZXNzIiwibG9hZCIsIm1hbmlmZXN0Iiwib25Mb2FkZWQiLCJjb25zb2xlIiwibG9nIiwic3JjIiwicSIsImxvYWRNYW5pZmVzdCIsImdldENvbnRlbnRCeUlkIiwiaWQiLCJnZXRSZXN1bHQiLCJBcHAiLCJjb250YWluZXIiLCJpbml0aWFsTG9hZCIsImxvYWRDb21wbGV0ZWQiLCJpbm5lckhUTUwiLCJpbml0aWFsVHJhbnNpdGlvbkluIiwiY2xhc3NMaXN0IiwiYWRkIiwiZGlzcG9zZSIsInByb3RvdHlwZSIsImVyciIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwib25LZXlEb3duIiwia2V5IiwidG9Mb3dlckNhc2UiLCJsb2NhdGlvbiIsInByZXZlbnREZWZhdWx0Iiwib25LZXlVcCIsInJlc2l6ZSIsIndpZHRoIiwiaW5uZXJXaWR0aCIsImhlaWdodCIsImlubmVySGVpZ2h0Iiwic3R5bGUiLCJ2aWV3U2l6ZSIsIlNpemUiLCJwb3NpdGlvbiIsImRyYXciLCJzdmciLCJTaGFwZSIsIkNpcmNsZSIsIlBvaW50IiwiZmlsbENvbG9yIiwiY2hpbGRyZW4iLCJzdHJva2VDb2xvciIsIkNvbG9yIiwic3Ryb2tlV2lkdGgiLCJzaGFkb3dDb2xvciIsInNoYWRvd0JsdXIiLCJzaGFkb3dPZmZzZXQiLCJSZWN0YW5nbGUiLCJib3VuZHMiLCJpIiwibGVuZ3RoIiwiTWF0aCIsInJhbmRvbSIsImdyYWRpZW50Iiwic3RvcHMiLCJvcmlnaW4iLCJ0b3BDZW50ZXIiLCJkZXN0aW5hdGlvbiIsImJvdHRvbUNlbnRlciIsInJldHVyblR5cGUiLCJSYXN0ZXIiLCJ4IiwiYm90dG9tUmlnaHQiLCJ5IiwiZGVsVHlwZSIsIkdyb3VwIiwiaW5pdFBhdGgiLCJzdHJva2VDYXAiLCJzdHJva2VKb2luIiwibGVmdENlbnRlciIsInJpZ2h0Q2VudGVyIiwiYnJpbmdUb0Zyb250IiwibG9jYXRlS2V5IiwiaW5kZXgiLCJhZGRUb1RleHQiLCJhZGRUb1BhdGgiLCJzZWdtZW50cyIsInNlbmRUb1ByaW50ZXIiLCJyZXNldEFsbCIsInNtb290aCIsImNoYXJhY3RlciIsInB1c2giLCJyZW1vdmVTZWdtZW50IiwicG9wIiwicGF0aEJveCIsInBhdGhDb3B5IiwiY2xvbmUiLCJzZW5kVG9CYWNrIiwiZXhwb3J0U1ZHIiwiYXNTdHJpbmciLCJibG9iIiwiQmxvYiIsInNhdmVBcyIsInJlbW92ZSIsInJlbW92ZVNlZ21lbnRzIiwiZ2V0RWxlbWVudEJ5SWQiXSwibWFwcGluZ3MiOiJBQUFBLFFBQUFBLFVBQUFDLEdBRUFDLEtBQUFDLEdBQUFDLFNBQUFDLGlCQUFBLFFBQUEsR0FDQUgsS0FBQUksT0FBQUYsU0FBQUcscUJBQUEsVUFBQSxHQUVBQyxNQUFBQyxNQUFBUCxLQUFBSSxRQUNBSixLQUFBUSxlQUVBUixLQUFBUyxTQUFBQyxPQUNBVixLQUFBVyxPQUFBRCxPQUNBVixLQUFBWSxLQUFBLEdBQUFOLE9BQUFPLEtBQ0FiLEtBQUFjLFNBQUFK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LEtBQUFnQixLQUFBNkUsR0FBQSxJQUlBLElBSUFkLElBSkEsR0FBQXpFLE9BQUF1RyxPQUFBbUIsRUFBQUMsSUFJQSx5Q0FDQWxELElBQUEsUUFDQUEsR0FBQS9FLEtBQUFZLEtBQUF3SCxXQUFBQyxVQUFBLElBQ0F0RCxHQUFBLFFBS0EsSUFBQXVELEdBQUEsR0FBQUMsT0FBQXhELElBQ0FoRSxLQUFBLHNCQUdBeUgsUUFBQUYsRUFBQSxZQUVBTixFQUFBUyxTQUNBUixFQUFBUSxVQU1BM0ksU0FBQTRELFVBQUFnRSxTQUFBLFdBRUExSCxLQUFBWSxLQUFBOEgsaUJBQ0ExSSxLQUFBZ0IsU0dsWUFkLFNBQUEyRCxpQkFBQSxtQkFBQSxXQUVBcEIsUUFBQUMsSUFBQSxNQUNBTyxJQUFBbEIsS0FBQTdCLFNBQUF5SSxlQUFBIiwiZmlsZSI6ImJ1bmRsZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBLZXlib2FyZChwYXJhbWV0ZXJzKSB7XG5cblx0dGhpcy5lbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ21haW4nKVswXTtcblx0dGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY2FudmFzJylbMF07XG5cblx0cGFwZXIuc2V0dXAodGhpcy5jYW52YXMpO1xuXHR0aGlzLmF0dGFjaEV2ZW50cygpO1xuXG5cdHRoaXMua2V5Ym9hcmQgPSB1bmRlZmluZWQ7XG5cdHRoaXMua2V5TWFwID0gdW5kZWZpbmVkO1xuXHR0aGlzLnBhdGggPSBuZXcgcGFwZXIuUGF0aCgpO1xuXHR0aGlzLmdyYXBoaWNzID0gdW5kZWZpbmVkO1xuXHR0aGlzLnR5cGUgPSB1bmRlZmluZWQ7XG5cblx0dGhpcy50ZXh0ID0gW107XG5cblx0dGhpcy5kZWJ1ZyA9IHtcblx0XHRjZW50ZXI6IHVuZGVmaW5lZCxcblx0XHRib3VuZGluZ0JveDogdW5kZWZpbmVkXG5cdH1cblxuXHRwYXBlci5wcm9qZWN0LmltcG9ydFNWRygnLi4vZGF0YS9rZXlib2FyZC5zdmcnLCB7IG9uTG9hZDogdGhpcy5pbml0S2V5Ym9hcmQuYmluZCh0aGlzKSwgb25FcnJvcjogdGhpcy5vbkVyci5iaW5kKHRoaXMpIH0pO1xuXHRwYXBlci52aWV3Lnpvb20gPSAwLjU7XG5cbn1cblxuS2V5Ym9hcmQucHJvdG90eXBlLm9uRXJyID0gZnVuY3Rpb24oZXJyKSB7XG5cdGNvbnNvbGUubG9nKGVycik7XG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5hdHRhY2hFdmVudHMgPSBmdW5jdGlvbigpIHtcblxuXHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcblx0XHR0aGlzLm9uS2V5RG93bihlLmtleS50b0xvd2VyQ2FzZSgpLCBlLmxvY2F0aW9uKTtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdH0uYmluZCh0aGlzKSk7XG5cblx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZSkge1xuXHRcdHRoaXMub25LZXlVcChlLmtleS50b0xvd2VyQ2FzZSgpLCBlLmxvY2F0aW9uKTtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdH0uYmluZCh0aGlzKSk7XG5cblx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGZ1bmN0aW9uKGUpIHtcblx0XHR0aGlzLnJlc2l6ZSgpO1xuXHR9LmJpbmQodGhpcykpO1xuXG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbigpIHtcblxuXHQvLyBWaWV3IHJlc2l6ZVxuXHR0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuXHR0aGlzLmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cdHRoaXMuY2FudmFzLnN0eWxlID0gJyc7XG5cdHBhcGVyLnZpZXcudmlld1NpemUgPSBuZXcgcGFwZXIuU2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTtcblxuXHQvLyBEZWJ1Z1xuXHR0aGlzLmRlYnVnLmNlbnRlci5wb3NpdGlvbiA9IHBhcGVyLnZpZXcuY2VudGVyO1xuXHR0aGlzLmRlYnVnLmJvdW5kaW5nQm94LnBvc2l0aW9uID0gcGFwZXIudmlldy5jZW50ZXI7XG5cblx0Ly8gUmVzcG9uc2l2ZVxuXHR0aGlzLmdyYXBoaWNzLnBvc2l0aW9uID0gcGFwZXIudmlldy5jZW50ZXI7XG5cblx0cGFwZXIudmlldy5kcmF3KCk7XG5cbn1cblxuS2V5Ym9hcmQucHJvdG90eXBlLmluaXRLZXlib2FyZCA9IGZ1bmN0aW9uKGtleWJvYXJkLCBzdmcpIHtcblxuXHRjb25zb2xlLmxvZygnSW1wb3J0ZWQhJyk7XG5cblx0Ly8gRGVidWdcblx0dGhpcy5kZWJ1Zy5jZW50ZXIgPSBuZXcgcGFwZXIuU2hhcGUuQ2lyY2xlKG5ldyBwYXBlci5Qb2ludCg4MCwgNTApLCAyKTtcblx0dGhpcy5kZWJ1Zy5jZW50ZXIuZmlsbENvbG9yID0gXCJyZWRcIjtcblxuXHQvLyBLZXlib2FyZFxuXHR0aGlzLmtleWJvYXJkID0ga2V5Ym9hcmQuY2hpbGRyZW5bMF07XG5cdC8vIHRoaXMua2V5Ym9hcmQuYXBwbHlNYXRyaXggPSBmYWxzZTtcblxuXHR0aGlzLmtleWJvYXJkLnN0eWxlID0ge1xuXHRcdGZpbGxDb2xvcjogXCIjODA4MDgwXCIsXG5cdFx0c3Ryb2tlQ29sb3I6IG5ldyBwYXBlci5Db2xvcigxLDEsMSwwLjQpLFxuXHRcdHN0cm9rZVdpZHRoOiAxLjUsXG5cdFx0c2hhZG93Q29sb3I6IG5ldyBwYXBlci5Db2xvcigwLDAsMCwwLjQ1KSxcblx0XHRzaGFkb3dCbHVyOiA0LFxuXHRcdHNoYWRvd09mZnNldDogbmV3IHBhcGVyLlBvaW50KDAsIDIpXG5cdH1cblxuXHQvLyBEZWJ1Z1xuXHR0aGlzLmRlYnVnLmJvdW5kaW5nQm94ID0gbmV3IHBhcGVyLlBhdGguUmVjdGFuZ2xlKHRoaXMua2V5Ym9hcmQuYm91bmRzKTtcblx0Ly8gdGhpcy5kZWJ1Zy5ib3VuZGluZ0JveC5zdHJva2VDb2xvciA9IFwiYmx1ZVwiO1xuXG5cdGZvciAodmFyIGkgPSB0aGlzLmtleWJvYXJkLmNoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdFx0XG5cdFx0Ly8gU3R5bGUga2V5cyBpbmRpdmlkdWFsbHlcblxuXHRcdHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baV0uc3Ryb2tlQ29sb3IgPSBuZXcgcGFwZXIuQ29sb3IoTWF0aC5yYW5kb20oKSwgTWF0aC5yYW5kb20oKSwgTWF0aC5yYW5kb20oKSk7XG5cdFx0dGhpcy5rZXlib2FyZC5jaGlsZHJlbltpXS5zdHJva2VDb2xvciA9IHtcblx0XHRcdGdyYWRpZW50OiB7XG5cdFx0XHRcdHN0b3BzOiBbbmV3IHBhcGVyLkNvbG9yKDEsMSwxLDAuMyksIG5ldyBwYXBlci5Db2xvcigxLDEsMSwwLjIpXVxuXHRcdFx0fSxcblx0XHRcdG9yaWdpbjogdGhpcy5rZXlib2FyZC5jaGlsZHJlbltpXS5ib3VuZHMudG9wQ2VudGVyLFxuXHRcdFx0ZGVzdGluYXRpb246IHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baV0uYm91bmRzLmJvdHRvbUNlbnRlclxuXHRcdH1cblxuXHR9XG5cblx0dGhpcy5rZXlNYXAgPSBbXG5cdFx0XCIxXCIsXG5cdFx0XCJgXCIsXG5cdFx0XCIyXCIsXG5cdFx0XCIzXCIsXG5cdFx0XCI0XCIsXG5cdFx0XCI1XCIsXG5cdFx0XCI2XCIsXG5cdFx0XCI3XCIsXG5cdFx0XCI4XCIsXG5cdFx0XCI5XCIsXG5cdFx0XCIwXCIsXG5cdFx0XCItXCIsXG5cdFx0XCI9XCIsXG5cdFx0XCJxXCIsXG5cdFx0XCJ3XCIsXG5cdFx0XCJlXCIsXG5cdFx0XCJyXCIsXG5cdFx0XCJ0XCIsXG5cdFx0XCJ5XCIsXG5cdFx0XCJ1XCIsXG5cdFx0XCJpXCIsXG5cdFx0XCJvXCIsXG5cdFx0XCJwXCIsXG5cdFx0XCJbXCIsXG5cdFx0XCJdXCIsXG5cdFx0XCJcXFxcXCIsXG5cdFx0XCJhXCIsXG5cdFx0XCJzXCIsXG5cdFx0XCJkXCIsXG5cdFx0XCJmXCIsXG5cdFx0XCJnXCIsXG5cdFx0XCJoXCIsXG5cdFx0XCJqXCIsXG5cdFx0XCJrXCIsXG5cdFx0XCJsXCIsXG5cdFx0XCI7XCIsXG5cdFx0XCInXCIsXG5cdFx0XCJ6XCIsXG5cdFx0XCJ4XCIsXG5cdFx0XCJjXCIsXG5cdFx0XCJ2XCIsXG5cdFx0XCJiXCIsXG5cdFx0XCJuXCIsXG5cdFx0XCJtXCIsXG5cdFx0XCIsXCIsXG5cdFx0XCIuXCIsXG5cdFx0XCIvXCIsXG5cdFx0XCJiYWNrc3BhY2VcIixcblx0XHRcInRhYlwiLFxuXHRcdFwiY2Fwc2xvY2tcIixcblx0XHRcInNoaWZ0XCIsIC8vIExcblx0XHRcIiBcIiwgLy8gU3BhY2Vcblx0XHRcIi8vbWV0YVwiLCAvLyBSXG5cdFx0XCJjb250cm9sXCIsIC8vIExcblx0XHRcIi8vYWx0XCIsIC8vIFJcblx0XHRcImFsdFwiLCAvLyBMXG5cdFx0XCIvL2NvbnRyb2xcIiwgLy8gUlxuXHRcdFwibWV0YVwiLCAvLyBMXG5cdFx0XCIvL3NoaWZ0XCIsIC8vIFJcblx0XHRcImVudGVyXCIsXG5cdF1cblxuXHR2YXIgcmV0dXJuVHlwZSA9IG5ldyBwYXBlci5SYXN0ZXIoJ3JldHVybicpO1xuXHRyZXR1cm5UeXBlLnBvc2l0aW9uLnggPSB0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzU5XS5ib3VuZHMuYm90dG9tUmlnaHQueCAtIHJldHVyblR5cGUud2lkdGgvMiAtIDEyO1xuXHRyZXR1cm5UeXBlLnBvc2l0aW9uLnkgPSB0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzU5XS5ib3VuZHMuYm90dG9tUmlnaHQueSAtIHJldHVyblR5cGUuaGVpZ2h0LzIgLSAxMjtcblxuXHR2YXIgZGVsVHlwZSA9IG5ldyBwYXBlci5SYXN0ZXIoJ2RlbCcpO1xuXHRkZWxUeXBlLnBvc2l0aW9uLnggPSB0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzQ3XS5ib3VuZHMuYm90dG9tUmlnaHQueCAtIGRlbFR5cGUud2lkdGgvMiAtIDEyO1xuXHRkZWxUeXBlLnBvc2l0aW9uLnkgPSB0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzQ3XS5ib3VuZHMuYm90dG9tUmlnaHQueSAtIGRlbFR5cGUuaGVpZ2h0LzIgLSAxMjtcblx0Ly8gdmFyIHJldHVyblR5cGUgPSBuZXcgcGFwZXIuUG9pbnRUZXh0KG5ldyBwYXBlci5Qb2ludCh0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzU5XS5ib3VuZHMuYm90dG9tUmlnaHQueCAtIDEyLCB0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzU5XS5ib3VuZHMuYm90dG9tUmlnaHQueSAtIDEyKSk7XG5cdC8vIHJldHVyblR5cGUuanVzdGlmaWNhdGlvbiA9ICdyaWdodCc7XG5cdC8vIHJldHVyblR5cGUuZm9udEZhbWlseT0gJ1JvYm90byc7XG5cblx0Ly8gcmV0dXJuVHlwZS5maWxsQ29sb3IgPSAnd2hpdGUnO1xuXHQvLyByZXR1cm5UeXBlLmNvbnRlbnQgPSAncmV0dXJuJztcblxuXHQvLyB2YXIgZGVsVHlwZSA9IG5ldyBwYXBlci5Qb2ludFRleHQobmV3IHBhcGVyLlBvaW50KHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5bNDddLmJvdW5kcy5ib3R0b21SaWdodC54IC0gMTIsIHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5bNDddLmJvdW5kcy5ib3R0b21SaWdodC55IC0gMTIpKTtcblx0Ly8gZGVsVHlwZS5qdXN0aWZpY2F0aW9uID0gJ3JpZ2h0Jztcblx0Ly8gZGVsVHlwZS5mb250RmFtaWx5PSAnUm9ib3RvJztcblxuXHQvLyBkZWxUeXBlLmZpbGxDb2xvciA9ICd3aGl0ZSc7XG5cdC8vIGRlbFR5cGUuY29udGVudCA9ICdkZWwnO1xuXG5cdHRoaXMudHlwZSA9IG5ldyBwYXBlci5Hcm91cChbcmV0dXJuVHlwZSwgZGVsVHlwZV0pO1xuXG5cdHRoaXMuaW5pdFBhdGgoKTtcblx0dGhpcy5yZXNpemUoKTtcblxufVxuXG5LZXlib2FyZC5wcm90b3R5cGUuaW5pdFBhdGggPSBmdW5jdGlvbigpIHtcblxuXHR0aGlzLnBhdGguc3R5bGUgPSB7XG5cdFx0c3Ryb2tlV2lkdGggOiA2LFxuXHRcdGZpbGxDb2xvcjogbmV3IHBhcGVyLkNvbG9yKDAsMCwwLDApLFxuXHRcdHN0cm9rZUNhcCA6ICdyb3VuZCcsXG5cdFx0c3Ryb2tlSm9pbiA6ICdyb3VuZCdcblx0fVxuXG5cdHRoaXMucGF0aC5zdHJva2VDb2xvciA9IHtcblx0XHRncmFkaWVudDoge1xuXHRcdFx0c3RvcHM6IFtuZXcgcGFwZXIuQ29sb3IoJyMwMEZGRjQnKSwgbmV3IHBhcGVyLkNvbG9yKCcjMUYwMEZGJyldXG5cdFx0fSxcblx0XHRvcmlnaW46IHRoaXMuZGVidWcuYm91bmRpbmdCb3guYm91bmRzLmxlZnRDZW50ZXIsXG5cdFx0ZGVzdGluYXRpb246IHRoaXMuZGVidWcuYm91bmRpbmdCb3guYm91bmRzLnJpZ2h0Q2VudGVyXG5cdH1cblxuXHR0aGlzLmdyYXBoaWNzID0gbmV3IHBhcGVyLkdyb3VwKFt0aGlzLmtleWJvYXJkLCB0aGlzLnBhdGgsIHRoaXMudHlwZV0pO1xuXHR0aGlzLmdyYXBoaWNzLmJyaW5nVG9Gcm9udCgpO1xuXG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5sb2NhdGVLZXkgPSBmdW5jdGlvbihrZXksIGxvY2F0aW9uKSB7XG5cblx0dmFyIGluZGV4ID0gbnVsbFxuXG5cdGlmKGxvY2F0aW9uID09IDEgfHwgbG9jYXRpb24gPT0gMCkge1xuXG5cdFx0Ly8gTGVmdCBzaWRlXG5cdFx0XG5cdFx0Zm9yICh2YXIgaSA9IHRoaXMua2V5TWFwLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdFx0XHRpZih0aGlzLmtleU1hcFtpXSA9PSBrZXkpIGluZGV4ID0gaTtcblx0XHR9XG5cblx0XHRpZihpbmRleCA9PSBudWxsKSB7XG5cdFx0XHRjb25zb2xlLmxvZygnTm8gbWF0Y2gnKTtcblx0XHR9XG5cblx0fVxuXHRlbHNlIGlmKGxvY2F0aW9uID09IDIpIHtcblxuXHRcdC8vIFJpZ2h0IHNpZGVcblxuXHRcdGlmKGtleSA9PSBcIm1ldGFcIikge1xuXHRcdFx0aW5kZXggPSA1Mjtcblx0XHR9XG5cblx0XHRpZihrZXkgPT0gXCJhbHRcIikge1xuXHRcdFx0aW5kZXggPSA1NDtcblx0XHR9XG5cblx0XHRpZihrZXkgPT0gXCJjb250cm9sXCIpIHtcblx0XHRcdGluZGV4ID0gNTY7XG5cdFx0fVxuXG5cdFx0aWYoa2V5ID09IFwic2hpZnRcIikge1xuXHRcdFx0aW5kZXggPSA1ODtcblx0XHR9XG5cblx0fVxuXG5cdHJldHVybiBpbmRleDtcblxufVxuXG5LZXlib2FyZC5wcm90b3R5cGUub25LZXlEb3duID0gZnVuY3Rpb24oa2V5LCBsb2NhdGlvbikge1xuXG5cdHZhciBpbmRleCA9IHRoaXMubG9jYXRlS2V5KGtleSwgbG9jYXRpb24pO1xuXG5cdHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baW5kZXhdLnNoYWRvd0NvbG9yID0gbmV3IHBhcGVyLkNvbG9yKDAsMCwwLDAuMik7XG5cdHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baW5kZXhdLnNoYWRvd0JsdXIgPSAxO1xuXHR0aGlzLmtleWJvYXJkLmNoaWxkcmVuW2luZGV4XS5zaGFkb3dPZmZzZXQgPSBuZXcgcGFwZXIuUG9pbnQoMCwgMSk7XG5cblx0aWYoa2V5ID09IFwiYmFja3NwYWNlXCIpIHtcblx0XHR0aGlzLmRlbGV0ZSgpO1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGlmKGtleSA9PSBcImVudGVyXCIpIHtcblx0XHRwYXBlci52aWV3LmRyYXcoKTtcblx0XHRyZXR1cm47XG5cdH1cblxuXHR0aGlzLmFkZFRvVGV4dChrZXkpO1xuXHR0aGlzLmFkZFRvUGF0aChpbmRleCk7XG5cbn1cblxuS2V5Ym9hcmQucHJvdG90eXBlLm9uS2V5VXAgPSBmdW5jdGlvbihrZXksIGxvY2F0aW9uKSB7XG5cblx0Zm9yICh2YXIgaSA9IHRoaXMua2V5Ym9hcmQuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcblx0XHRcblx0XHR0aGlzLmtleWJvYXJkLmNoaWxkcmVuW2ldLnNoYWRvd0NvbG9yID0gbmV3IHBhcGVyLkNvbG9yKDAsMCwwLDAuNDUpO1xuXHRcdHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baV0uc2hhZG93Qmx1ciA9IDQ7XG5cdFx0dGhpcy5rZXlib2FyZC5jaGlsZHJlbltpXS5zaGFkb3dPZmZzZXQgPSBuZXcgcGFwZXIuUG9pbnQoMCwgMik7XG5cblx0fVxuXG5cdGlmKGtleSA9PSBcImVudGVyXCIpIHtcblx0XHRpZih0aGlzLnBhdGguc2VnbWVudHMubGVuZ3RoID4gMSkge1xuXHRcdFx0dGhpcy5zZW5kVG9QcmludGVyKCk7XG5cdFx0XHR0aGlzLnJlc2V0QWxsKCk7XG5cdFx0fVxuXHR9XG5cblx0cGFwZXIudmlldy5kcmF3KCk7XG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5hZGRUb1BhdGggPSBmdW5jdGlvbihpbmRleCkge1xuXG5cdHRoaXMucGF0aC5hZGQodGhpcy5rZXlib2FyZC5jaGlsZHJlbltpbmRleF0uYm91bmRzLmNlbnRlcik7XG5cdHRoaXMucGF0aC5zbW9vdGgoKTtcblxuXHRwYXBlci52aWV3LmRyYXcoKTtcblxufVxuXG5LZXlib2FyZC5wcm90b3R5cGUuYWRkVG9UZXh0ID0gZnVuY3Rpb24oY2hhcmFjdGVyKSB7XG5cblx0dGhpcy50ZXh0LnB1c2goY2hhcmFjdGVyKTtcblxufVxuXG5LZXlib2FyZC5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24oKSB7XG5cblx0dGhpcy5wYXRoLnJlbW92ZVNlZ21lbnQodGhpcy5wYXRoLnNlZ21lbnRzLmxlbmd0aC0xKTtcblx0dGhpcy50ZXh0LnBvcCgpO1xuXG5cdHBhcGVyLnZpZXcuZHJhdygpO1xuXG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5zZW5kVG9QcmludGVyID0gZnVuY3Rpb24oKSB7XG5cblx0Ly8gcmVtb3ZlQ2xhc3MoZmxhc2gsICdmbGFzaCcpO1xuXHQvLyB2b2lkIGZsYXNoLm9mZnNldFdpZHRoO1xuXHQvLyBhZGRDbGFzcyhmbGFzaCwgJ2ZsYXNoJyk7XG5cblx0dmFyIHBhdGhCb3ggPSBuZXcgcGFwZXIuUGF0aC5SZWN0YW5nbGUocGFwZXIudmlldy5ib3VuZHMpO1xuXHR2YXIgcGF0aENvcHkgPSB0aGlzLnBhdGguY2xvbmUoKTtcblx0XG5cdHBhdGhCb3guZmlsbENvbG9yID0gXCJ3aGl0ZVwiO1xuXHRwYXRoQm94LnNlbmRUb0JhY2soKTtcblx0XG5cdHBhdGhDb3B5LmJyaW5nVG9Gcm9udCgpO1xuXHRwYXRoQ29weS5zdHJva2VDb2xvciA9IFwiYmxhY2tcIjtcblx0cGF0aENvcHkuc3Ryb2tlV2lkdGggPSAyNTtcblxuXHQvLyB0aGlzLmtleWJvYXJkLm9wYWNpdHkgPSAwO1xuXHQvLyBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiI0ZGRkZGRlwiO1xuXG5cdC8vIHBhcGVyLnZpZXcuZHJhdygpO1xuXG5cdC8vIEZvcm1hdCB0ZXh0IGZvciBleHBvcnRpbmdcblx0Zm9yICh2YXIgaSA9IHRoaXMudGV4dC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuXHRcdGlmKHRoaXMudGV4dFtpXSA9PSAnbWV0YScgfHwgdGhpcy50ZXh0W2ldID09ICdjb250cm9sJyB8fCB0aGlzLnRleHRbaV0gPT0gJ2FsdCcgfHwgdGhpcy50ZXh0W2ldID09ICdzaGlmdCcgfHwgdGhpcy50ZXh0W2ldID09ICd0YWInIHx8IHRoaXMudGV4dFtpXSA9PSAnY2Fwc2xvY2snKSB7XG5cdFx0XHR0aGlzLnRleHRbaV0gPSAn4paRJztcblx0XHR9XG5cdH1cblxuXHR2YXIgZXhwb3J0cyA9IG5ldyBwYXBlci5Hcm91cChbcGF0aEJveCwgcGF0aENvcHldKTtcblxuXHQvLyBGb3JtYXQgc3ZnIGZvciBzYXZpbmdcblx0Ly8gdmFyIHN2ZyA9IGV4cG9ydHMuZXhwb3J0U1ZHKHsgYXNTdHJpbmc6IHRydWUgfSk7XG5cdHZhciBzdmcgPSAnPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIj8+Jztcblx0c3ZnICs9ICc8c3ZnPic7XG5cdHN2ZyArPSB0aGlzLnBhdGguZXhwb3J0U1ZHKHsgYXNTdHJpbmc6IHRydWUgfSk7XG5cdHN2ZyArPSAnPC9zdmc+Jztcblx0Ly8gc3ZnICs9ICc8c3ZnIHZlcnNpb249XCIxLjFcIiBpZD1cIkNhbHF1ZV8xXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHhtbG5zOnhsaW5rPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiIHg9XCIwcHhcIiB5PVwiMHB4XCIgd2lkdGg9XCIyMTM2cHhcIiBoZWlnaHQ9XCI3MThweFwiIHZpZXdCb3g9XCItNDgyIDE4MCAyMTM2IDcxOFwiIGVuYWJsZS1iYWNrZ3JvdW5kPVwibmV3IC00ODIgMTgwIDIxMzYgNzE4XCIgeG1sOnNwYWNlPVwicHJlc2VydmVcIj4nO1xuXHQvLyBzdmcgKz0gZXhwb3J0cy5leHBvcnRTVkcoeyBhc1N0cmluZzogdHJ1ZSB9KTtcblx0Ly8gc3ZnICs9ICc8L3N2Zz4nO1xuXG5cdHZhciBibG9iID0gbmV3IEJsb2IoW3N2Z10sIHtcblx0XHR0eXBlOiAnZGF0YTppbWFnZS9zdmcreG1sJ1xuXHR9KTtcblxuXHRzYXZlQXMoYmxvYiwgJ3Rlc3Quc3ZnJyk7XG5cblx0cGF0aEJveC5yZW1vdmUoKTtcblx0cGF0aENvcHkucmVtb3ZlKCk7XG5cdC8vIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCIjODA4MDgwXCI7XG5cdC8vIHRoaXMua2V5Ym9hcmQub3BhY2l0eSA9IDE7XG5cbn1cblxuS2V5Ym9hcmQucHJvdG90eXBlLnJlc2V0QWxsID0gZnVuY3Rpb24oKSB7XG5cblx0dGhpcy5wYXRoLnJlbW92ZVNlZ21lbnRzKCk7XG5cdHRoaXMudGV4dCA9IFtdO1xuXG59IiwidmFyIExvYWRlciA9IHtcblxuXHRxdWV1ZSA6IHVuZGVmaW5lZCxcblxuXHRpbml0OiBmdW5jdGlvbigpIHtcblx0XHR0aGlzLnF1ZXVlID0gbmV3IGNyZWF0ZWpzLkxvYWRRdWV1ZSgpO1xuXHRcdHRoaXMucXVldWUub24oJ2NvbXBsZXRlJywgdGhpcy5vbkxvYWRDb21wbGV0ZWQpO1xuXHRcdHRoaXMucXVldWUub24oJ2Vycm9yJywgdGhpcy5vbkxvYWRFcnJvcik7XG5cdFx0dGhpcy5xdWV1ZS5vbigncHJvZ3Jlc3MnLCB0aGlzLm9uTG9hZFByb2dyZXNzKTtcblx0fSxcblxuXHRsb2FkOiBmdW5jdGlvbihtYW5pZmVzdCwgb25Mb2FkZWQpIHtcblx0XHRjb25zb2xlLmxvZygnTG9hZGluZzonLCBtYW5pZmVzdFswXS5zcmMpO1xuXHRcdHZhciBxID0gdGhpcy5xdWV1ZTtcblx0XHRxLm9uKCdjb21wbGV0ZScsIG9uTG9hZGVkKTtcblx0XHRxLmxvYWRNYW5pZmVzdChtYW5pZmVzdCk7XG5cdH0sXG5cblx0Z2V0Q29udGVudEJ5SWQ6IGZ1bmN0aW9uKGlkKSB7XG5cdFx0cmV0dXJuIHRoaXMucXVldWUuZ2V0UmVzdWx0KGlkKTtcblx0fSxcblxuXHRvbkxvYWRDb21wbGV0ZWQ6IGZ1bmN0aW9uKCkge1xuXHRcdGNvbnNvbGUubG9nKCdMb2FkIENvbXBsZXRlZCcpO1xuXHR9LFxuXG5cdG9uTG9hZEVycm9yOiBmdW5jdGlvbigpIHtcblx0XHRjb25zb2xlLmxvZygnTG9hZCBFcnJvcicpO1xuXHR9LFxuXG5cdG9uTG9hZFByb2dyZXNzOiBmdW5jdGlvbigpIHtcblx0XHRjb25zb2xlLmxvZygnLicpO1xuXHR9LFxuXHRcbn07IiwidmFyIEFwcCA9IHtcblxuXHRjb250YWluZXI6IHVuZGVmaW5lZCxcblxuXHRpbml0OiBmdW5jdGlvbihjb250YWluZXIpIHtcblx0XHR0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcblx0XHRMb2FkZXIuaW5pdCgpO1xuXHRcdHRoaXMuaW5pdGlhbExvYWQoKTtcblx0fSxcblxuXHRpbml0aWFsTG9hZDogZnVuY3Rpb24oKSB7XG5cdFx0TG9hZGVyLmxvYWQoW1xuXHRcdFx0e2lkOiAnaG9tZXBhZ2UnLCBzcmM6ICdkYXRhL2hvbWVwYWdlLmh0bWwnfVxuXHRcdF0sIHRoaXMubG9hZENvbXBsZXRlZC5iaW5kKHRoaXMpKTsgLy8gQmluZGluZyBhbGxvd3MgdG8ga2VlcCB0aGUgQXBwIHNjb3BlIG9uIGNhbGxiYWNrXG5cdH0sXG5cblx0bG9hZENvbXBsZXRlZDogZnVuY3Rpb24oKSB7XG5cdFx0dGhpcy5jb250YWluZXIuaW5uZXJIVE1MID0gTG9hZGVyLmdldENvbnRlbnRCeUlkKCdob21lcGFnZScpO1xuXHRcdHRoaXMuaW5pdGlhbFRyYW5zaXRpb25JbigpO1xuXHR9LFxuXG5cdGluaXRpYWxUcmFuc2l0aW9uSW46IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2ZhZGUtaW4nKTtcblx0XHRjb25zb2xlLmxvZygnW1BBTl0g4piR77iPJyk7XG5cdFx0S2V5Ym9hcmQgPSBuZXcgS2V5Ym9hcmQoKTtcblx0fSxcblxuXHRkaXNwb3NlOiBmdW5jdGlvbigpIHtcblx0XHR0aGlzLmNvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcblx0fVxuXG59OyIsImRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uKCkge1xuXG5cdGNvbnNvbGUubG9nKCfwn5G7Jyk7XG5cdEFwcC5pbml0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSk7XG5cbn0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
