function Keyboard(e){this.el=document.querySelectorAll("main")[0],this.canvas=document.getElementsByTagName("canvas")[0],paper.setup(this.canvas),this.attachEvents(),this.keyboard=void 0,this.keyMap=void 0,this.path=new paper.Path,this.graphics=void 0,this.type=void 0,this.text=[],this.debug={center:void 0,boundingBox:void 0},paper.project.importSVG("../data/keyboard.svg",{onLoad:this.initKeyboard.bind(this),onError:this.onErr.bind(this)}),paper.view.zoom=.5}var Loader={queue:void 0,init:function(){this.queue=new createjs.LoadQueue,this.queue.on("complete",this.onLoadCompleted),this.queue.on("error",this.onLoadError),this.queue.on("progress",this.onLoadProgress)},load:function(e,t){console.log("Loading:",e[0].src);var o=this.queue;o.on("complete",t),o.loadManifest(e)},getContentById:function(e){return this.queue.getResult(e)},onLoadCompleted:function(){console.log("Load Completed")},onLoadError:function(){console.log("Load Error")},onLoadProgress:function(){console.log(".")}},App={container:void 0,init:function(e){this.container=e,Loader.init(),this.initialLoad()},initialLoad:function(){Loader.load([{id:"homepage",src:"data/homepage.html"}],this.loadCompleted.bind(this))},loadCompleted:function(){this.container.innerHTML=Loader.getContentById("homepage"),this.initialTransitionIn()},initialTransitionIn:function(){this.container.classList.add("fade-in"),console.log("[PAN] ☑️"),Keyboard=new Keyboard},dispose:function(){this.container.innerHTML=""}};Keyboard.prototype.onErr=function(e){console.log(e)},Keyboard.prototype.attachEvents=function(){window.addEventListener("keydown",function(e){this.onKeyDown(e.key.toLowerCase(),e.location),e.preventDefault()}.bind(this)),window.addEventListener("keyup",function(e){this.onKeyUp(e.key.toLowerCase(),e.location),e.preventDefault()}.bind(this)),window.addEventListener("resize",function(e){this.resize()}.bind(this))},Keyboard.prototype.resize=function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.style="",paper.view.viewSize=new paper.Size(window.innerWidth,window.innerHeight),this.debug.center.position=paper.view.center,this.debug.boundingBox.position=paper.view.center,this.graphics.position=paper.view.center,paper.view.draw()},Keyboard.prototype.initKeyboard=function(e,t){console.log("Imported!"),this.debug.center=new paper.Shape.Circle(new paper.Point(80,50),2),this.debug.center.fillColor="red",this.keyboard=e.children[0],this.keyboard.style={fillColor:"#808080",strokeColor:new paper.Color(1,1,1,.4),strokeWidth:1.5,shadowColor:new paper.Color(0,0,0,.45),shadowBlur:4,shadowOffset:new paper.Point(0,2)},this.debug.boundingBox=new paper.Path.Rectangle(this.keyboard.bounds);for(var o=this.keyboard.children.length-1;o>=0;o--)this.keyboard.children[o].strokeColor=new paper.Color(Math.random(),Math.random(),Math.random()),this.keyboard.children[o].strokeColor={gradient:{stops:[new paper.Color(1,1,1,.3),new paper.Color(1,1,1,.2)]},origin:this.keyboard.children[o].bounds.topCenter,destination:this.keyboard.children[o].bounds.bottomCenter};this.keyMap=["1","`","2","3","4","5","6","7","8","9","0","-","=","q","w","e","r","t","y","u","i","o","p","[","]","\\","a","s","d","f","g","h","j","k","l",";","'","z","x","c","v","b","n","m",",",".","/","backspace","tab","capslock","shift"," ","//meta","control","//alt","alt","//control","meta","//shift","enter"];var i=new paper.Raster("return");i.position.x=this.keyboard.children[59].bounds.bottomRight.x-i.width/2-12,i.position.y=this.keyboard.children[59].bounds.bottomRight.y-i.height/2-12;var n=new paper.Raster("del");n.position.x=this.keyboard.children[47].bounds.bottomRight.x-n.width/2-12,n.position.y=this.keyboard.children[47].bounds.bottomRight.y-n.height/2-12,this.type=new paper.Group([i,n]),this.initPath(),this.resize()},Keyboard.prototype.initPath=function(){this.path.style={strokeWidth:6,fillColor:new paper.Color(0,0,0,0),strokeCap:"round",strokeJoin:"round"},this.path.strokeColor={gradient:{stops:[new paper.Color("#00FFF4"),new paper.Color("#1F00FF")]},origin:this.debug.boundingBox.bounds.leftCenter,destination:this.debug.boundingBox.bounds.rightCenter},this.graphics=new paper.Group([this.keyboard,this.path,this.type]),this.graphics.bringToFront()},Keyboard.prototype.locateKey=function(e,t){var o=null;if(1==t||0==t){for(var i=this.keyMap.length-1;i>=0;i--)this.keyMap[i]==e&&(o=i);null==o&&console.log("No match")}else 2==t&&("meta"==e&&(o=52),"alt"==e&&(o=54),"control"==e&&(o=56),"shift"==e&&(o=58));return o},Keyboard.prototype.onKeyDown=function(e,t){var o=this.locateKey(e,t);return this.keyboard.children[o].shadowColor=new paper.Color(0,0,0,.2),this.keyboard.children[o].shadowBlur=1,this.keyboard.children[o].shadowOffset=new paper.Point(0,1),"backspace"==e?void this["delete"]():"enter"==e?void paper.view.draw():(this.addToText(e),void this.addToPath(o))},Keyboard.prototype.onKeyUp=function(e,t){for(var o=this.keyboard.children.length-1;o>=0;o--)this.keyboard.children[o].shadowColor=new paper.Color(0,0,0,.45),this.keyboard.children[o].shadowBlur=4,this.keyboard.children[o].shadowOffset=new paper.Point(0,2);"enter"==e&&this.path.segments.length>1&&(this.sendToPrinter(),this.resetAll()),paper.view.draw()},Keyboard.prototype.addToPath=function(e){this.path.add(this.keyboard.children[e].bounds.center),this.path.smooth(),paper.view.draw()},Keyboard.prototype.addToText=function(e){this.text.push(e)},Keyboard.prototype["delete"]=function(){this.path.removeSegment(this.path.segments.length-1),this.text.pop(),paper.view.draw()},Keyboard.prototype.sendToPrinter=function(){for(var e=this.text.length-1;e>=0;e--)("meta"==this.text[e]||"control"==this.text[e]||"alt"==this.text[e]||"shift"==this.text[e]||"tab"==this.text[e]||"capslock"==this.text[e])&&(this.text[e]="░");var t='<?xml version="1.0" encoding="utf-8"?>';t+='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="'+paper.view.bounds.width+'" height="'+paper.view.bounds.height+'">',t+=this.path.exportSVG({asString:!0}),t+="</svg>";var o=new Blob([t],{type:"data:image/svg+xml"});saveAs(o,this.text.join("")+".svg")},Keyboard.prototype.resetAll=function(){this.path.removeSegments(),this.text=[]},document.addEventListener("DOMContentLoaded",function(){console.log("👻"),App.init(document.getElementById("container"))});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIktleWJvYXJkLmpzIiwibG9hZGVyLmpzIiwiYXBwLmpzIiwiaW5kZXguanMiXSwibmFtZXMiOlsiS2V5Ym9hcmQiLCJwYXJhbWV0ZXJzIiwidGhpcyIsImVsIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiY2FudmFzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJwYXBlciIsInNldHVwIiwiYXR0YWNoRXZlbnRzIiwia2V5Ym9hcmQiLCJ1bmRlZmluZWQiLCJrZXlNYXAiLCJwYXRoIiwiUGF0aCIsImdyYXBoaWNzIiwidHlwZSIsInRleHQiLCJkZWJ1ZyIsImNlbnRlciIsImJvdW5kaW5nQm94IiwicHJvamVjdCIsImltcG9ydFNWRyIsIm9uTG9hZCIsImluaXRLZXlib2FyZCIsImJpbmQiLCJvbkVycm9yIiwib25FcnIiLCJ2aWV3Iiwiem9vbSIsIkxvYWRlciIsInF1ZXVlIiwiaW5pdCIsImNyZWF0ZWpzIiwiTG9hZFF1ZXVlIiwib24iLCJvbkxvYWRDb21wbGV0ZWQiLCJvbkxvYWRFcnJvciIsIm9uTG9hZFByb2dyZXNzIiwibG9hZCIsIm1hbmlmZXN0Iiwib25Mb2FkZWQiLCJjb25zb2xlIiwibG9nIiwic3JjIiwicSIsImxvYWRNYW5pZmVzdCIsImdldENvbnRlbnRCeUlkIiwiaWQiLCJnZXRSZXN1bHQiLCJBcHAiLCJjb250YWluZXIiLCJpbml0aWFsTG9hZCIsImxvYWRDb21wbGV0ZWQiLCJpbm5lckhUTUwiLCJpbml0aWFsVHJhbnNpdGlvbkluIiwiY2xhc3NMaXN0IiwiYWRkIiwiZGlzcG9zZSIsInByb3RvdHlwZSIsImVyciIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwib25LZXlEb3duIiwia2V5IiwidG9Mb3dlckNhc2UiLCJsb2NhdGlvbiIsInByZXZlbnREZWZhdWx0Iiwib25LZXlVcCIsInJlc2l6ZSIsIndpZHRoIiwiaW5uZXJXaWR0aCIsImhlaWdodCIsImlubmVySGVpZ2h0Iiwic3R5bGUiLCJ2aWV3U2l6ZSIsIlNpemUiLCJwb3NpdGlvbiIsImRyYXciLCJzdmciLCJTaGFwZSIsIkNpcmNsZSIsIlBvaW50IiwiZmlsbENvbG9yIiwiY2hpbGRyZW4iLCJzdHJva2VDb2xvciIsIkNvbG9yIiwic3Ryb2tlV2lkdGgiLCJzaGFkb3dDb2xvciIsInNoYWRvd0JsdXIiLCJzaGFkb3dPZmZzZXQiLCJSZWN0YW5nbGUiLCJib3VuZHMiLCJpIiwibGVuZ3RoIiwiTWF0aCIsInJhbmRvbSIsImdyYWRpZW50Iiwic3RvcHMiLCJvcmlnaW4iLCJ0b3BDZW50ZXIiLCJkZXN0aW5hdGlvbiIsImJvdHRvbUNlbnRlciIsInJldHVyblR5cGUiLCJSYXN0ZXIiLCJ4IiwiYm90dG9tUmlnaHQiLCJ5IiwiZGVsVHlwZSIsIkdyb3VwIiwiaW5pdFBhdGgiLCJzdHJva2VDYXAiLCJzdHJva2VKb2luIiwibGVmdENlbnRlciIsInJpZ2h0Q2VudGVyIiwiYnJpbmdUb0Zyb250IiwibG9jYXRlS2V5IiwiaW5kZXgiLCJhZGRUb1RleHQiLCJhZGRUb1BhdGgiLCJzZWdtZW50cyIsInNlbmRUb1ByaW50ZXIiLCJyZXNldEFsbCIsInNtb290aCIsImNoYXJhY3RlciIsInB1c2giLCJyZW1vdmVTZWdtZW50IiwicG9wIiwiZXhwb3J0U1ZHIiwiYXNTdHJpbmciLCJibG9iIiwiQmxvYiIsInNhdmVBcyIsImpvaW4iLCJyZW1vdmVTZWdtZW50cyIsImdldEVsZW1lbnRCeUlkIl0sIm1hcHBpbmdzIjoiQUFBQSxRQUFBQSxVQUFBQyxHQUVBQyxLQUFBQyxHQUFBQyxTQUFBQyxpQkFBQSxRQUFBLEdBQ0FILEtBQUFJLE9BQUFGLFNBQUFHLHFCQUFBLFVBQUEsR0FFQUMsTUFBQUMsTUFBQVAsS0FBQUksUUFDQUosS0FBQVEsZUFFQVIsS0FBQVMsU0FBQUMsT0FDQVYsS0FBQVcsT0FBQUQsT0FDQVYsS0FBQVksS0FBQSxHQUFBTixPQUFBTyxLQUNBYixLQUFBYyxTQUFBSixPQUNBVixLQUFBZSxLQUFBTCxPQUVBVixLQUFBZ0IsUUFFQWhCLEtBQUFp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QkFHQXFILFFBQUFGLEVBQUFsSSxLQUFBZ0IsS0FBQXFILEtBQUEsSUFBQSxTQUlBdkksU0FBQTRELFVBQUFnRSxTQUFBLFdBRUExSCxLQUFBWSxLQUFBMEgsaUJBQ0F0SSxLQUFBZ0IsU0dwV0FkLFNBQUEyRCxpQkFBQSxtQkFBQSxXQUVBcEIsUUFBQUMsSUFBQSxNQUNBTyxJQUFBbEIsS0FBQTdCLFNBQUFxSSxlQUFBIiwiZmlsZSI6ImJ1bmRsZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBLZXlib2FyZChwYXJhbWV0ZXJzKSB7XG5cblx0dGhpcy5lbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ21haW4nKVswXTtcblx0dGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnY2FudmFzJylbMF07XG5cblx0cGFwZXIuc2V0dXAodGhpcy5jYW52YXMpO1xuXHR0aGlzLmF0dGFjaEV2ZW50cygpO1xuXG5cdHRoaXMua2V5Ym9hcmQgPSB1bmRlZmluZWQ7XG5cdHRoaXMua2V5TWFwID0gdW5kZWZpbmVkO1xuXHR0aGlzLnBhdGggPSBuZXcgcGFwZXIuUGF0aCgpO1xuXHR0aGlzLmdyYXBoaWNzID0gdW5kZWZpbmVkO1xuXHR0aGlzLnR5cGUgPSB1bmRlZmluZWQ7XG5cblx0dGhpcy50ZXh0ID0gW107XG5cblx0dGhpcy5kZWJ1ZyA9IHtcblx0XHRjZW50ZXI6IHVuZGVmaW5lZCxcblx0XHRib3VuZGluZ0JveDogdW5kZWZpbmVkXG5cdH1cblxuXHRwYXBlci5wcm9qZWN0LmltcG9ydFNWRygnLi4vZGF0YS9rZXlib2FyZC5zdmcnLCB7IG9uTG9hZDogdGhpcy5pbml0S2V5Ym9hcmQuYmluZCh0aGlzKSwgb25FcnJvcjogdGhpcy5vbkVyci5iaW5kKHRoaXMpIH0pO1xuXHRwYXBlci52aWV3Lnpvb20gPSAwLjU7XG5cbn1cblxuS2V5Ym9hcmQucHJvdG90eXBlLm9uRXJyID0gZnVuY3Rpb24oZXJyKSB7XG5cdGNvbnNvbGUubG9nKGVycik7XG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5hdHRhY2hFdmVudHMgPSBmdW5jdGlvbigpIHtcblxuXHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcblx0XHR0aGlzLm9uS2V5RG93bihlLmtleS50b0xvd2VyQ2FzZSgpLCBlLmxvY2F0aW9uKTtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdH0uYmluZCh0aGlzKSk7XG5cblx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZSkge1xuXHRcdHRoaXMub25LZXlVcChlLmtleS50b0xvd2VyQ2FzZSgpLCBlLmxvY2F0aW9uKTtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdH0uYmluZCh0aGlzKSk7XG5cblx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGZ1bmN0aW9uKGUpIHtcblx0XHR0aGlzLnJlc2l6ZSgpO1xuXHR9LmJpbmQodGhpcykpO1xuXG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbigpIHtcblxuXHQvLyBWaWV3IHJlc2l6ZVxuXHR0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuXHR0aGlzLmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cdHRoaXMuY2FudmFzLnN0eWxlID0gJyc7XG5cdHBhcGVyLnZpZXcudmlld1NpemUgPSBuZXcgcGFwZXIuU2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTtcblxuXHQvLyBEZWJ1Z1xuXHR0aGlzLmRlYnVnLmNlbnRlci5wb3NpdGlvbiA9IHBhcGVyLnZpZXcuY2VudGVyO1xuXHR0aGlzLmRlYnVnLmJvdW5kaW5nQm94LnBvc2l0aW9uID0gcGFwZXIudmlldy5jZW50ZXI7XG5cblx0Ly8gUmVzcG9uc2l2ZVxuXHR0aGlzLmdyYXBoaWNzLnBvc2l0aW9uID0gcGFwZXIudmlldy5jZW50ZXI7XG5cblx0cGFwZXIudmlldy5kcmF3KCk7XG5cbn1cblxuS2V5Ym9hcmQucHJvdG90eXBlLmluaXRLZXlib2FyZCA9IGZ1bmN0aW9uKGtleWJvYXJkLCBzdmcpIHtcblxuXHRjb25zb2xlLmxvZygnSW1wb3J0ZWQhJyk7XG5cblx0Ly8gRGVidWdcblx0dGhpcy5kZWJ1Zy5jZW50ZXIgPSBuZXcgcGFwZXIuU2hhcGUuQ2lyY2xlKG5ldyBwYXBlci5Qb2ludCg4MCwgNTApLCAyKTtcblx0dGhpcy5kZWJ1Zy5jZW50ZXIuZmlsbENvbG9yID0gXCJyZWRcIjtcblxuXHQvLyBLZXlib2FyZFxuXHR0aGlzLmtleWJvYXJkID0ga2V5Ym9hcmQuY2hpbGRyZW5bMF07XG5cdC8vIHRoaXMua2V5Ym9hcmQuYXBwbHlNYXRyaXggPSBmYWxzZTtcblxuXHR0aGlzLmtleWJvYXJkLnN0eWxlID0ge1xuXHRcdGZpbGxDb2xvcjogXCIjODA4MDgwXCIsXG5cdFx0c3Ryb2tlQ29sb3I6IG5ldyBwYXBlci5Db2xvcigxLDEsMSwwLjQpLFxuXHRcdHN0cm9rZVdpZHRoOiAxLjUsXG5cdFx0c2hhZG93Q29sb3I6IG5ldyBwYXBlci5Db2xvcigwLDAsMCwwLjQ1KSxcblx0XHRzaGFkb3dCbHVyOiA0LFxuXHRcdHNoYWRvd09mZnNldDogbmV3IHBhcGVyLlBvaW50KDAsIDIpXG5cdH1cblxuXHQvLyBEZWJ1Z1xuXHR0aGlzLmRlYnVnLmJvdW5kaW5nQm94ID0gbmV3IHBhcGVyLlBhdGguUmVjdGFuZ2xlKHRoaXMua2V5Ym9hcmQuYm91bmRzKTtcblx0Ly8gdGhpcy5kZWJ1Zy5ib3VuZGluZ0JveC5zdHJva2VDb2xvciA9IFwiYmx1ZVwiO1xuXG5cdGZvciAodmFyIGkgPSB0aGlzLmtleWJvYXJkLmNoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdFx0XG5cdFx0Ly8gU3R5bGUga2V5cyBpbmRpdmlkdWFsbHlcblxuXHRcdHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baV0uc3Ryb2tlQ29sb3IgPSBuZXcgcGFwZXIuQ29sb3IoTWF0aC5yYW5kb20oKSwgTWF0aC5yYW5kb20oKSwgTWF0aC5yYW5kb20oKSk7XG5cdFx0dGhpcy5rZXlib2FyZC5jaGlsZHJlbltpXS5zdHJva2VDb2xvciA9IHtcblx0XHRcdGdyYWRpZW50OiB7XG5cdFx0XHRcdHN0b3BzOiBbbmV3IHBhcGVyLkNvbG9yKDEsMSwxLDAuMyksIG5ldyBwYXBlci5Db2xvcigxLDEsMSwwLjIpXVxuXHRcdFx0fSxcblx0XHRcdG9yaWdpbjogdGhpcy5rZXlib2FyZC5jaGlsZHJlbltpXS5ib3VuZHMudG9wQ2VudGVyLFxuXHRcdFx0ZGVzdGluYXRpb246IHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baV0uYm91bmRzLmJvdHRvbUNlbnRlclxuXHRcdH1cblxuXHR9XG5cblx0dGhpcy5rZXlNYXAgPSBbXG5cdFx0XCIxXCIsXG5cdFx0XCJgXCIsXG5cdFx0XCIyXCIsXG5cdFx0XCIzXCIsXG5cdFx0XCI0XCIsXG5cdFx0XCI1XCIsXG5cdFx0XCI2XCIsXG5cdFx0XCI3XCIsXG5cdFx0XCI4XCIsXG5cdFx0XCI5XCIsXG5cdFx0XCIwXCIsXG5cdFx0XCItXCIsXG5cdFx0XCI9XCIsXG5cdFx0XCJxXCIsXG5cdFx0XCJ3XCIsXG5cdFx0XCJlXCIsXG5cdFx0XCJyXCIsXG5cdFx0XCJ0XCIsXG5cdFx0XCJ5XCIsXG5cdFx0XCJ1XCIsXG5cdFx0XCJpXCIsXG5cdFx0XCJvXCIsXG5cdFx0XCJwXCIsXG5cdFx0XCJbXCIsXG5cdFx0XCJdXCIsXG5cdFx0XCJcXFxcXCIsXG5cdFx0XCJhXCIsXG5cdFx0XCJzXCIsXG5cdFx0XCJkXCIsXG5cdFx0XCJmXCIsXG5cdFx0XCJnXCIsXG5cdFx0XCJoXCIsXG5cdFx0XCJqXCIsXG5cdFx0XCJrXCIsXG5cdFx0XCJsXCIsXG5cdFx0XCI7XCIsXG5cdFx0XCInXCIsXG5cdFx0XCJ6XCIsXG5cdFx0XCJ4XCIsXG5cdFx0XCJjXCIsXG5cdFx0XCJ2XCIsXG5cdFx0XCJiXCIsXG5cdFx0XCJuXCIsXG5cdFx0XCJtXCIsXG5cdFx0XCIsXCIsXG5cdFx0XCIuXCIsXG5cdFx0XCIvXCIsXG5cdFx0XCJiYWNrc3BhY2VcIixcblx0XHRcInRhYlwiLFxuXHRcdFwiY2Fwc2xvY2tcIixcblx0XHRcInNoaWZ0XCIsIC8vIExcblx0XHRcIiBcIiwgLy8gU3BhY2Vcblx0XHRcIi8vbWV0YVwiLCAvLyBSXG5cdFx0XCJjb250cm9sXCIsIC8vIExcblx0XHRcIi8vYWx0XCIsIC8vIFJcblx0XHRcImFsdFwiLCAvLyBMXG5cdFx0XCIvL2NvbnRyb2xcIiwgLy8gUlxuXHRcdFwibWV0YVwiLCAvLyBMXG5cdFx0XCIvL3NoaWZ0XCIsIC8vIFJcblx0XHRcImVudGVyXCIsXG5cdF1cblxuXHR2YXIgcmV0dXJuVHlwZSA9IG5ldyBwYXBlci5SYXN0ZXIoJ3JldHVybicpO1xuXHRyZXR1cm5UeXBlLnBvc2l0aW9uLnggPSB0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzU5XS5ib3VuZHMuYm90dG9tUmlnaHQueCAtIHJldHVyblR5cGUud2lkdGgvMiAtIDEyO1xuXHRyZXR1cm5UeXBlLnBvc2l0aW9uLnkgPSB0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzU5XS5ib3VuZHMuYm90dG9tUmlnaHQueSAtIHJldHVyblR5cGUuaGVpZ2h0LzIgLSAxMjtcblxuXHR2YXIgZGVsVHlwZSA9IG5ldyBwYXBlci5SYXN0ZXIoJ2RlbCcpO1xuXHRkZWxUeXBlLnBvc2l0aW9uLnggPSB0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzQ3XS5ib3VuZHMuYm90dG9tUmlnaHQueCAtIGRlbFR5cGUud2lkdGgvMiAtIDEyO1xuXHRkZWxUeXBlLnBvc2l0aW9uLnkgPSB0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzQ3XS5ib3VuZHMuYm90dG9tUmlnaHQueSAtIGRlbFR5cGUuaGVpZ2h0LzIgLSAxMjtcblx0Ly8gdmFyIHJldHVyblR5cGUgPSBuZXcgcGFwZXIuUG9pbnRUZXh0KG5ldyBwYXBlci5Qb2ludCh0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzU5XS5ib3VuZHMuYm90dG9tUmlnaHQueCAtIDEyLCB0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzU5XS5ib3VuZHMuYm90dG9tUmlnaHQueSAtIDEyKSk7XG5cdC8vIHJldHVyblR5cGUuanVzdGlmaWNhdGlvbiA9ICdyaWdodCc7XG5cdC8vIHJldHVyblR5cGUuZm9udEZhbWlseT0gJ1JvYm90byc7XG5cblx0Ly8gcmV0dXJuVHlwZS5maWxsQ29sb3IgPSAnd2hpdGUnO1xuXHQvLyByZXR1cm5UeXBlLmNvbnRlbnQgPSAncmV0dXJuJztcblxuXHQvLyB2YXIgZGVsVHlwZSA9IG5ldyBwYXBlci5Qb2ludFRleHQobmV3IHBhcGVyLlBvaW50KHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5bNDddLmJvdW5kcy5ib3R0b21SaWdodC54IC0gMTIsIHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5bNDddLmJvdW5kcy5ib3R0b21SaWdodC55IC0gMTIpKTtcblx0Ly8gZGVsVHlwZS5qdXN0aWZpY2F0aW9uID0gJ3JpZ2h0Jztcblx0Ly8gZGVsVHlwZS5mb250RmFtaWx5PSAnUm9ib3RvJztcblxuXHQvLyBkZWxUeXBlLmZpbGxDb2xvciA9ICd3aGl0ZSc7XG5cdC8vIGRlbFR5cGUuY29udGVudCA9ICdkZWwnO1xuXG5cdHRoaXMudHlwZSA9IG5ldyBwYXBlci5Hcm91cChbcmV0dXJuVHlwZSwgZGVsVHlwZV0pO1xuXG5cdHRoaXMuaW5pdFBhdGgoKTtcblx0dGhpcy5yZXNpemUoKTtcblxufVxuXG5LZXlib2FyZC5wcm90b3R5cGUuaW5pdFBhdGggPSBmdW5jdGlvbigpIHtcblxuXHR0aGlzLnBhdGguc3R5bGUgPSB7XG5cdFx0c3Ryb2tlV2lkdGggOiA2LFxuXHRcdGZpbGxDb2xvcjogbmV3IHBhcGVyLkNvbG9yKDAsMCwwLDApLFxuXHRcdHN0cm9rZUNhcCA6ICdyb3VuZCcsXG5cdFx0c3Ryb2tlSm9pbiA6ICdyb3VuZCdcblx0fVxuXG5cdHRoaXMucGF0aC5zdHJva2VDb2xvciA9IHtcblx0XHRncmFkaWVudDoge1xuXHRcdFx0c3RvcHM6IFtuZXcgcGFwZXIuQ29sb3IoJyMwMEZGRjQnKSwgbmV3IHBhcGVyLkNvbG9yKCcjMUYwMEZGJyldXG5cdFx0fSxcblx0XHRvcmlnaW46IHRoaXMuZGVidWcuYm91bmRpbmdCb3guYm91bmRzLmxlZnRDZW50ZXIsXG5cdFx0ZGVzdGluYXRpb246IHRoaXMuZGVidWcuYm91bmRpbmdCb3guYm91bmRzLnJpZ2h0Q2VudGVyXG5cdH1cblxuXHR0aGlzLmdyYXBoaWNzID0gbmV3IHBhcGVyLkdyb3VwKFt0aGlzLmtleWJvYXJkLCB0aGlzLnBhdGgsIHRoaXMudHlwZV0pO1xuXHR0aGlzLmdyYXBoaWNzLmJyaW5nVG9Gcm9udCgpO1xuXG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5sb2NhdGVLZXkgPSBmdW5jdGlvbihrZXksIGxvY2F0aW9uKSB7XG5cblx0dmFyIGluZGV4ID0gbnVsbFxuXG5cdGlmKGxvY2F0aW9uID09IDEgfHwgbG9jYXRpb24gPT0gMCkge1xuXG5cdFx0Ly8gTGVmdCBzaWRlXG5cdFx0XG5cdFx0Zm9yICh2YXIgaSA9IHRoaXMua2V5TWFwLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdFx0XHRpZih0aGlzLmtleU1hcFtpXSA9PSBrZXkpIGluZGV4ID0gaTtcblx0XHR9XG5cblx0XHRpZihpbmRleCA9PSBudWxsKSB7XG5cdFx0XHRjb25zb2xlLmxvZygnTm8gbWF0Y2gnKTtcblx0XHR9XG5cblx0fVxuXHRlbHNlIGlmKGxvY2F0aW9uID09IDIpIHtcblxuXHRcdC8vIFJpZ2h0IHNpZGVcblxuXHRcdGlmKGtleSA9PSBcIm1ldGFcIikge1xuXHRcdFx0aW5kZXggPSA1Mjtcblx0XHR9XG5cblx0XHRpZihrZXkgPT0gXCJhbHRcIikge1xuXHRcdFx0aW5kZXggPSA1NDtcblx0XHR9XG5cblx0XHRpZihrZXkgPT0gXCJjb250cm9sXCIpIHtcblx0XHRcdGluZGV4ID0gNTY7XG5cdFx0fVxuXG5cdFx0aWYoa2V5ID09IFwic2hpZnRcIikge1xuXHRcdFx0aW5kZXggPSA1ODtcblx0XHR9XG5cblx0fVxuXG5cdHJldHVybiBpbmRleDtcblxufVxuXG5LZXlib2FyZC5wcm90b3R5cGUub25LZXlEb3duID0gZnVuY3Rpb24oa2V5LCBsb2NhdGlvbikge1xuXG5cdHZhciBpbmRleCA9IHRoaXMubG9jYXRlS2V5KGtleSwgbG9jYXRpb24pO1xuXG5cdHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baW5kZXhdLnNoYWRvd0NvbG9yID0gbmV3IHBhcGVyLkNvbG9yKDAsMCwwLDAuMik7XG5cdHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baW5kZXhdLnNoYWRvd0JsdXIgPSAxO1xuXHR0aGlzLmtleWJvYXJkLmNoaWxkcmVuW2luZGV4XS5zaGFkb3dPZmZzZXQgPSBuZXcgcGFwZXIuUG9pbnQoMCwgMSk7XG5cblx0aWYoa2V5ID09IFwiYmFja3NwYWNlXCIpIHtcblx0XHR0aGlzLmRlbGV0ZSgpO1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGlmKGtleSA9PSBcImVudGVyXCIpIHtcblx0XHRwYXBlci52aWV3LmRyYXcoKTtcblx0XHRyZXR1cm47XG5cdH1cblxuXHR0aGlzLmFkZFRvVGV4dChrZXkpO1xuXHR0aGlzLmFkZFRvUGF0aChpbmRleCk7XG5cbn1cblxuS2V5Ym9hcmQucHJvdG90eXBlLm9uS2V5VXAgPSBmdW5jdGlvbihrZXksIGxvY2F0aW9uKSB7XG5cblx0Zm9yICh2YXIgaSA9IHRoaXMua2V5Ym9hcmQuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcblx0XHRcblx0XHR0aGlzLmtleWJvYXJkLmNoaWxkcmVuW2ldLnNoYWRvd0NvbG9yID0gbmV3IHBhcGVyLkNvbG9yKDAsMCwwLDAuNDUpO1xuXHRcdHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baV0uc2hhZG93Qmx1ciA9IDQ7XG5cdFx0dGhpcy5rZXlib2FyZC5jaGlsZHJlbltpXS5zaGFkb3dPZmZzZXQgPSBuZXcgcGFwZXIuUG9pbnQoMCwgMik7XG5cblx0fVxuXG5cdGlmKGtleSA9PSBcImVudGVyXCIpIHtcblx0XHRpZih0aGlzLnBhdGguc2VnbWVudHMubGVuZ3RoID4gMSkge1xuXHRcdFx0dGhpcy5zZW5kVG9QcmludGVyKCk7XG5cdFx0XHR0aGlzLnJlc2V0QWxsKCk7XG5cdFx0fVxuXHR9XG5cblx0cGFwZXIudmlldy5kcmF3KCk7XG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5hZGRUb1BhdGggPSBmdW5jdGlvbihpbmRleCkge1xuXG5cdHRoaXMucGF0aC5hZGQodGhpcy5rZXlib2FyZC5jaGlsZHJlbltpbmRleF0uYm91bmRzLmNlbnRlcik7XG5cdHRoaXMucGF0aC5zbW9vdGgoKTtcblxuXHRwYXBlci52aWV3LmRyYXcoKTtcblxufVxuXG5LZXlib2FyZC5wcm90b3R5cGUuYWRkVG9UZXh0ID0gZnVuY3Rpb24oY2hhcmFjdGVyKSB7XG5cblx0dGhpcy50ZXh0LnB1c2goY2hhcmFjdGVyKTtcblxufVxuXG5LZXlib2FyZC5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24oKSB7XG5cblx0dGhpcy5wYXRoLnJlbW92ZVNlZ21lbnQodGhpcy5wYXRoLnNlZ21lbnRzLmxlbmd0aC0xKTtcblx0dGhpcy50ZXh0LnBvcCgpO1xuXG5cdHBhcGVyLnZpZXcuZHJhdygpO1xuXG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5zZW5kVG9QcmludGVyID0gZnVuY3Rpb24oKSB7XG5cblx0Ly8gRm9ybWF0IHRleHQgZm9yIGV4cG9ydGluZ1xuXHRmb3IgKHZhciBpID0gdGhpcy50ZXh0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdFx0aWYodGhpcy50ZXh0W2ldID09ICdtZXRhJyB8fCB0aGlzLnRleHRbaV0gPT0gJ2NvbnRyb2wnIHx8IHRoaXMudGV4dFtpXSA9PSAnYWx0JyB8fCB0aGlzLnRleHRbaV0gPT0gJ3NoaWZ0JyB8fCB0aGlzLnRleHRbaV0gPT0gJ3RhYicgfHwgdGhpcy50ZXh0W2ldID09ICdjYXBzbG9jaycpIHtcblx0XHRcdHRoaXMudGV4dFtpXSA9ICfilpEnO1xuXHRcdH1cblx0fVxuXG5cdC8vIEZvcm1hdCBzdmcgZm9yIHNhdmluZ1xuXHR2YXIgc3ZnID0gJzw/eG1sIHZlcnNpb249XCIxLjBcIiBlbmNvZGluZz1cInV0Zi04XCI/Pic7XG5cdHN2ZyArPSAnPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgeG1sbnM6eGxpbms9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCIgeD1cIjBweFwiIHk9XCIwcHhcIiB3aWR0aD1cIicgKyBwYXBlci52aWV3LmJvdW5kcy53aWR0aCArICdcIiBoZWlnaHQ9XCInICsgcGFwZXIudmlldy5ib3VuZHMuaGVpZ2h0ICsgJ1wiPic7XG5cdHN2ZyArPSB0aGlzLnBhdGguZXhwb3J0U1ZHKHsgYXNTdHJpbmc6IHRydWUgfSk7XG5cdHN2ZyArPSAnPC9zdmc+JztcblxuXHR2YXIgYmxvYiA9IG5ldyBCbG9iKFtzdmddLCB7XG5cdFx0dHlwZTogJ2RhdGE6aW1hZ2Uvc3ZnK3htbCdcblx0fSk7XG5cblx0c2F2ZUFzKGJsb2IsIHRoaXMudGV4dC5qb2luKCcnKSArICcuc3ZnJyk7XG5cbn1cblxuS2V5Ym9hcmQucHJvdG90eXBlLnJlc2V0QWxsID0gZnVuY3Rpb24oKSB7XG5cblx0dGhpcy5wYXRoLnJlbW92ZVNlZ21lbnRzKCk7XG5cdHRoaXMudGV4dCA9IFtdO1xuXG59IiwidmFyIExvYWRlciA9IHtcblxuXHRxdWV1ZSA6IHVuZGVmaW5lZCxcblxuXHRpbml0OiBmdW5jdGlvbigpIHtcblx0XHR0aGlzLnF1ZXVlID0gbmV3IGNyZWF0ZWpzLkxvYWRRdWV1ZSgpO1xuXHRcdHRoaXMucXVldWUub24oJ2NvbXBsZXRlJywgdGhpcy5vbkxvYWRDb21wbGV0ZWQpO1xuXHRcdHRoaXMucXVldWUub24oJ2Vycm9yJywgdGhpcy5vbkxvYWRFcnJvcik7XG5cdFx0dGhpcy5xdWV1ZS5vbigncHJvZ3Jlc3MnLCB0aGlzLm9uTG9hZFByb2dyZXNzKTtcblx0fSxcblxuXHRsb2FkOiBmdW5jdGlvbihtYW5pZmVzdCwgb25Mb2FkZWQpIHtcblx0XHRjb25zb2xlLmxvZygnTG9hZGluZzonLCBtYW5pZmVzdFswXS5zcmMpO1xuXHRcdHZhciBxID0gdGhpcy5xdWV1ZTtcblx0XHRxLm9uKCdjb21wbGV0ZScsIG9uTG9hZGVkKTtcblx0XHRxLmxvYWRNYW5pZmVzdChtYW5pZmVzdCk7XG5cdH0sXG5cblx0Z2V0Q29udGVudEJ5SWQ6IGZ1bmN0aW9uKGlkKSB7XG5cdFx0cmV0dXJuIHRoaXMucXVldWUuZ2V0UmVzdWx0KGlkKTtcblx0fSxcblxuXHRvbkxvYWRDb21wbGV0ZWQ6IGZ1bmN0aW9uKCkge1xuXHRcdGNvbnNvbGUubG9nKCdMb2FkIENvbXBsZXRlZCcpO1xuXHR9LFxuXG5cdG9uTG9hZEVycm9yOiBmdW5jdGlvbigpIHtcblx0XHRjb25zb2xlLmxvZygnTG9hZCBFcnJvcicpO1xuXHR9LFxuXG5cdG9uTG9hZFByb2dyZXNzOiBmdW5jdGlvbigpIHtcblx0XHRjb25zb2xlLmxvZygnLicpO1xuXHR9LFxuXHRcbn07IiwidmFyIEFwcCA9IHtcblxuXHRjb250YWluZXI6IHVuZGVmaW5lZCxcblxuXHRpbml0OiBmdW5jdGlvbihjb250YWluZXIpIHtcblx0XHR0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcblx0XHRMb2FkZXIuaW5pdCgpO1xuXHRcdHRoaXMuaW5pdGlhbExvYWQoKTtcblx0fSxcblxuXHRpbml0aWFsTG9hZDogZnVuY3Rpb24oKSB7XG5cdFx0TG9hZGVyLmxvYWQoW1xuXHRcdFx0e2lkOiAnaG9tZXBhZ2UnLCBzcmM6ICdkYXRhL2hvbWVwYWdlLmh0bWwnfVxuXHRcdF0sIHRoaXMubG9hZENvbXBsZXRlZC5iaW5kKHRoaXMpKTsgLy8gQmluZGluZyBhbGxvd3MgdG8ga2VlcCB0aGUgQXBwIHNjb3BlIG9uIGNhbGxiYWNrXG5cdH0sXG5cblx0bG9hZENvbXBsZXRlZDogZnVuY3Rpb24oKSB7XG5cdFx0dGhpcy5jb250YWluZXIuaW5uZXJIVE1MID0gTG9hZGVyLmdldENvbnRlbnRCeUlkKCdob21lcGFnZScpO1xuXHRcdHRoaXMuaW5pdGlhbFRyYW5zaXRpb25JbigpO1xuXHR9LFxuXG5cdGluaXRpYWxUcmFuc2l0aW9uSW46IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2ZhZGUtaW4nKTtcblx0XHRjb25zb2xlLmxvZygnW1BBTl0g4piR77iPJyk7XG5cdFx0S2V5Ym9hcmQgPSBuZXcgS2V5Ym9hcmQoKTtcblx0fSxcblxuXHRkaXNwb3NlOiBmdW5jdGlvbigpIHtcblx0XHR0aGlzLmNvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcblx0fVxuXG59OyIsImRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uKCkge1xuXG5cdGNvbnNvbGUubG9nKCfwn5G7Jyk7XG5cdEFwcC5pbml0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSk7XG5cbn0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
