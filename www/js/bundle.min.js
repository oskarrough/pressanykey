function Keyboard(e){this.el=document.querySelectorAll("main")[0],this.canvas=document.getElementsByTagName("canvas")[0],this.keyMap=void 0,this.debug={},this.props={},paper.setup(this.canvas),this.attachEvents(),this.draw()}var Loader={queue:void 0,init:function(){this.queue=new createjs.LoadQueue,this.queue.on("complete",this.onLoadCompleted),this.queue.on("error",this.onLoadError),this.queue.on("progress",this.onLoadProgress)},load:function(e,t){console.log("Loading:",e[0].src);var n=this.queue;n.on("complete",t),n.loadManifest(e)},getContentById:function(e){return this.queue.getResult(e)},onLoadCompleted:function(){console.log("Load Completed")},onLoadError:function(){console.log("Load Error")},onLoadProgress:function(){console.log(".")}},App={container:void 0,init:function(e){this.container=e,Loader.init(),this.initialLoad()},initialLoad:function(){Loader.load([{id:"homepage",src:"data/homepage.html"}],this.loadCompleted.bind(this))},loadCompleted:function(){this.container.innerHTML=Loader.getContentById("homepage"),this.initialTransitionIn()},initialTransitionIn:function(){this.container.classList.add("fade-in"),console.log("[PAN] ‚òëÔ∏è"),Keyboard=new Keyboard},dispose:function(){this.container.innerHTML=""}};Keyboard.prototype.attachEvents=function(){window.addEventListener("resize",function(e){this.draw()}.bind(this))},Keyboard.prototype.draw=function(){paper.project.activeLayer.removeChildren(),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.style="",paper.view.viewSize=new paper.Size(window.innerWidth,window.innerHeight),this.keyboard=new paper.Group,this.path=new paper.Path,this.graphics=new paper.Group([this.keyboard,this.path]),this.graphics.bringToFront(),this.drawKeyboard(),this.graphics.position=paper.view.center,this.debug.center=new paper.Shape.Circle(new paper.Point(80,50),2),this.debug.center.fillColor="red",this.debug.boundingBox=new paper.Path.Rectangle(this.keyboard.bounds),this.debug.center.position=paper.view.center,this.debug.boundingBox.position=paper.view.center,paper.view.draw()},Keyboard.prototype.drawKeyboard=function(e){var t=Math.round(.9*paper.view.bounds.width),n=Math.round(.007*paper.view.bounds.width),a=Math.round((t-13*n)/15.5);console.log(n),console.log(t),console.log(a);for(var o=0;o<13;o++){var i=new paper.Rectangle(new paper.Point(o*(a+n),0),a),r=new paper.Path.Rectangle(i,new paper.Size(4,4));this.keyboard.addChild(r)}var p=new paper.Rectangle(new paper.Point(13*(a+n),0),new paper.Size(1.5*a,a)),d=new paper.Path.Rectangle(p,new paper.Size(4,4));this.keyboard.addChild(d);var s=new paper.Rectangle(new paper.Point(0,a+n),new paper.Size(1.5*a,a)),h=new paper.Path.Rectangle(s,new paper.Size(4,4));this.keyboard.addChild(h);for(var o=0;o<13;o++){var i=new paper.Rectangle(new paper.Point(o*(a+n)+h.bounds.width+n,a+n),a),r=new paper.Path.Rectangle(i,new paper.Size(4,4));this.keyboard.addChild(r)}var l=new paper.Rectangle(new paper.Point(0,2*(a+n)),new paper.Size(1.5*a+n,a)),w=new paper.Path.Rectangle(l,new paper.Size(4,4));this.keyboard.addChild(w);for(var o=0;o<11;o++){var i=new paper.Rectangle(new paper.Point(o*(a+n)+w.bounds.width+n,2*(a+n)),a),r=new paper.Path.Rectangle(i,new paper.Size(4,4));this.keyboard.addChild(r)}var c=new paper.Rectangle(new paper.Point(this.keyboard.lastChild.bounds.topRight.x+n,2*(a+n)),new paper.Size(2*a,a)),g=new paper.Path.Rectangle(c,new paper.Size(4,4));this.keyboard.addChild(g);var u=new paper.Rectangle(new paper.Point(0,3*(a+n)),new paper.Size(2*a+2*n,a)),b=new paper.Path.Rectangle(u,new paper.Size(4,4));this.keyboard.addChild(b);for(var o=0;o<10;o++){var i=new paper.Rectangle(new paper.Point(o*(a+n)+b.bounds.width+n,3*(a+n)),a),r=new paper.Path.Rectangle(i,new paper.Size(4,4));this.keyboard.addChild(r)}var y=new paper.Rectangle(new paper.Point(this.keyboard.lastChild.bounds.topRight.x+n,3*(a+n)),new paper.Point(g.bounds.bottomRight.x,g.bounds.bottomRight.y+n+a)),v=new paper.Path.Rectangle(y,new paper.Size(4,4));this.keyboard.addChild(v);var f=new paper.Rectangle(new paper.Point(0,4*(a+n)),new paper.Size(1.5*a,a)),C=new paper.Path.Rectangle(f,new paper.Size(4,4));this.keyboard.addChild(C);var P=new paper.Rectangle(new paper.Point(1.5*a+n,4*(a+n)),new paper.Size(a+n,a)),k=new paper.Path.Rectangle(P,new paper.Size(4,4));this.keyboard.addChild(k);var m=new paper.Rectangle(new paper.Point(this.keyboard.lastChild.bounds.topRight.x+n,4*(a+n)),new paper.Point(4*a+5*n-n,4*(a+n)+a)),R=new paper.Path.Rectangle(m,new paper.Size(4,4));this.keyboard.addChild(R);var x=new paper.Rectangle(new paper.Point(4*a+5*n,4*(a+n)),new paper.Size(6*a+5*n,a)),S=new paper.Path.Rectangle(x,new paper.Size(4,4));this.keyboard.addChild(S),this.keyboard.style={fillColor:"#808080",strokeColor:new paper.Color(1,1,1,.4),strokeWidth:1.1,shadowColor:new paper.Color(0,0,0,.45),shadowBlur:4,shadowOffset:new paper.Point(0,2)}},Keyboard.prototype.initPath=function(){this.path.style={strokeWidth:6,fillColor:new paper.Color(0,0,0,0),strokeCap:"round",strokeJoin:"round"},this.path.strokeColor={gradient:{stops:[new paper.Color("#00FFF4"),new paper.Color("#1F00FF")]},origin:this.debug.boundingBox.bounds.leftCenter,destination:this.debug.boundingBox.bounds.rightCenter},this.graphics=new paper.Group([this.keyboard,this.path]),this.graphics.bringToFront()},Keyboard.prototype.locateKey=function(e,t){var n=null;if(1==t||0==t){for(var a=this.keyMap.length-1;a>=0;a--)this.keyMap[a]==e&&(n=a);null==n&&console.log("No match")}else 2==t&&("meta"==e&&(n=52),"alt"==e&&(n=54),"control"==e&&(n=56),"shift"==e&&(n=58));return n},Keyboard.prototype.onKeyDown=function(e,t){var n=this.locateKey(e,t);return this.keyboard.children[n].shadowColor=new paper.Color(0,0,0,.2),this.keyboard.children[n].shadowBlur=1,this.keyboard.children[n].shadowOffset=new paper.Point(0,1),"backspace"==e?void this["delete"]():"enter"==e?void paper.view.draw():(this.addToText(e),void this.addToPath(n))},Keyboard.prototype.onKeyUp=function(e,t){for(var n=this.keyboard.children.length-1;n>=0;n--)this.keyboard.children[n].shadowColor=new paper.Color(0,0,0,.45),this.keyboard.children[n].shadowBlur=4,this.keyboard.children[n].shadowOffset=new paper.Point(0,2);"enter"==e&&this.path.segments.length>1&&(this.sendToPrinter(),this.resetAll()),paper.view.draw()},Keyboard.prototype.addToPath=function(e){this.path.add(this.keyboard.children[e].bounds.center),this.path.smooth(),paper.view.draw()},Keyboard.prototype.addToText=function(e){this.text.push(e)},Keyboard.prototype["delete"]=function(){this.path.removeSegment(this.path.segments.length-1),this.text.pop(),paper.view.draw()},Keyboard.prototype.sendToPrinter=function(){for(var e=this.text.length-1;e>=0;e--)"meta"!=this.text[e]&&"control"!=this.text[e]&&"alt"!=this.text[e]&&"shift"!=this.text[e]&&"tab"!=this.text[e]&&"capslock"!=this.text[e]||(this.text[e]="‚ñë");var t='<?xml version="1.0" encoding="utf-8"?>';t+='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="'+paper.view.bounds.width+'" height="'+paper.view.bounds.height+'">',t+=this.path.exportSVG({asString:!0}),t+="</svg>";var n=new Blob([t],{type:"data:image/svg+xml"});saveAs(n,this.text.join("")+".svg")},Keyboard.prototype.resetAll=function(){this.path.removeSegments(),this.text=[]},document.addEventListener("DOMContentLoaded",function(){console.log("üëª"),App.init(document.getElementById("container"))});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIktleWJvYXJkLmpzIiwibG9hZGVyLmpzIiwiYXBwLmpzIiwiaW5kZXguanMiXSwibmFtZXMiOlsiS2V5Ym9hcmQiLCJwYXJhbWV0ZXJzIiwidGhpcyIsImVsIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiY2FudmFzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJrZXlNYXAiLCJ1bmRlZmluZWQiLCJkZWJ1ZyIsInByb3BzIiwicGFwZXIiLCJzZXR1cCIsImF0dGFjaEV2ZW50cyIsImRyYXciLCJMb2FkZXIiLCJxdWV1ZSIsImluaXQiLCJjcmVhdGVqcyIsIkxvYWRRdWV1ZSIsIm9uIiwib25Mb2FkQ29tcGxldGVkIiwib25Mb2FkRXJyb3IiLCJvbkxvYWRQcm9ncmVzcyIsImxvYWQiLCJtYW5pZmVzdCIsIm9uTG9hZGVkIiwiY29uc29sZSIsImxvZyIsInNyYyIsInEiLCJsb2FkTWFuaWZlc3QiLCJnZXRDb250ZW50QnlJZCIsImlkIiwiZ2V0UmVzdWx0IiwiQXBwIiwiY29udGFpbmVyIiwiaW5pdGlhbExvYWQiLCJsb2FkQ29tcGxldGVkIiwiYmluZCIsImlubmVySFRNTCIsImluaXRpYWxUcmFuc2l0aW9uSW4iLCJjbGFzc0xpc3QiLCJhZGQiLCJkaXNwb3NlIiwicHJvdG90eXBlIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJwcm9qZWN0IiwiYWN0aXZlTGF5ZXIiLCJyZW1vdmVDaGlsZHJlbiIsIndpZHRoIiwiaW5uZXJXaWR0aCIsImhlaWdodCIsImlubmVySGVpZ2h0Iiwic3R5bGUiLCJ2aWV3Iiwidmlld1NpemUiLCJTaXplIiwia2V5Ym9hcmQiLCJHcm91cCIsInBhdGgiLCJQYXRoIiwiZ3JhcGhpY3MiLCJicmluZ1RvRnJvbnQiLCJkcmF3S2V5Ym9hcmQiLCJwb3NpdGlvbiIsImNlbnRlciIsIlNoYXBlIiwiQ2lyY2xlIiwiUG9pbnQiLCJmaWxsQ29sb3IiLCJib3VuZGluZ0JveCIsIlJlY3RhbmdsZSIsImJvdW5kcyIsImtleWJvYXJkV2lkdGgiLCJNYXRoIiwicm91bmQiLCJtYXJnaW4iLCJrZXlTaXplIiwiaSIsImtleSIsImFkZENoaWxkIiwiZGVsIiwiZGVsS2V5IiwidGFiIiwidGFiS2V5IiwiY2wiLCJjbEtleSIsInJ0IiwibGFzdENoaWxkIiwidG9wUmlnaHQiLCJ4IiwicnRLZXkiLCJzaGlmdCIsInNoaWZ0S2V5Iiwic2hpZnQyIiwiYm90dG9tUmlnaHQiLCJ5Iiwic2hpZnQyS2V5IiwiY3RybDEiLCJjdHJsMUtleSIsImFsdDEiLCJhbHQxS2V5IiwiY21kMSIsImNtZDFLZXkiLCJzcGFjZSIsInNwYWNlS2V5Iiwic3Ryb2tlQ29sb3IiLCJDb2xvciIsInN0cm9rZVdpZHRoIiwic2hhZG93Q29sb3IiLCJzaGFkb3dCbHVyIiwic2hhZG93T2Zmc2V0IiwiaW5pdFBhdGgiLCJzdHJva2VDYXAiLCJzdHJva2VKb2luIiwiZ3JhZGllbnQiLCJzdG9wcyIsIm9yaWdpbiIsImxlZnRDZW50ZXIiLCJkZXN0aW5hdGlvbiIsInJpZ2h0Q2VudGVyIiwibG9jYXRlS2V5IiwibG9jYXRpb24iLCJpbmRleCIsImxlbmd0aCIsIm9uS2V5RG93biIsImNoaWxkcmVuIiwiYWRkVG9UZXh0IiwiYWRkVG9QYXRoIiwib25LZXlVcCIsInNlZ21lbnRzIiwic2VuZFRvUHJpbnRlciIsInJlc2V0QWxsIiwic21vb3RoIiwiY2hhcmFjdGVyIiwidGV4dCIsInB1c2giLCJyZW1vdmVTZWdtZW50IiwicG9wIiwic3ZnIiwiZXhwb3J0U1ZHIiwiYXNTdHJpbmciLCJibG9iIiwiQmxvYiIsInR5cGUiLCJzYXZlQXMiLCJqb2luIiwicmVtb3ZlU2VnbWVudHMiLCJnZXRFbGVtZW50QnlJZCJdLCJtYXBwaW5ncyI6IkFBQUEsUUFBQUEsVUFBQUMsR0FFQUMsS0FBQUMsR0FBQUMsU0FBQUMsaUJBQUEsUUFBQSxHQUNBSCxLQUFBSSxPQUFBRixTQUFBRyxxQkFBQSxVQUFBLEdBRUFMLEtBQUFNLE9BQUFDLE9BQ0FQLEtBQUFRLFNBQ0FSLEtB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U0FBQWhGLEtBQUF5SSxLQUFBekQsSUFBQSxPQUFBaEYsS0FBQXlJLEtBQUF6RCxJQUFBLFlBQUFoRixLQUFBeUksS0FBQXpELEtBQ0FoRixLQUFBeUksS0FBQXpELEdBQUEsSUFLQSxJQUFBNkQsR0FBQSx3Q0FDQUEsSUFBQSw2R0FBQW5JLE1BQUE4QyxLQUFBa0IsT0FBQXZCLE1BQUEsYUFBQXpDLE1BQUE4QyxLQUFBa0IsT0FBQXJCLE9BQUEsS0FDQXdGLEdBQUE3SSxLQUFBNkQsS0FBQWlGLFdBQUFDLFVBQUEsSUFDQUYsR0FBQSxRQUVBLElBQUFHLEdBQUEsR0FBQUMsT0FBQUosSUFDQUssS0FBQSxzQkFHQUMsUUFBQUgsRUFBQWhKLEtBQUF5SSxLQUFBVyxLQUFBLElBQUEsU0FJQXRKLFNBQUE4QyxVQUFBMEYsU0FBQSxXQUVBdEksS0FBQTZELEtBQUF3RixpQkFDQXJKLEtBQUF5SSxTRzVjQXZJLFNBQUE0QyxpQkFBQSxtQkFBQSxXQUVBcEIsUUFBQUMsSUFBQSxNQUNBTyxJQUFBbEIsS0FBQWQsU0FBQW9KLGVBQUEiLCJmaWxlIjoiYnVuZGxlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIEtleWJvYXJkKHBhcmFtZXRlcnMpIHtcblxuXHR0aGlzLmVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnbWFpbicpWzBdO1xuXHR0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdjYW52YXMnKVswXTtcblxuXHR0aGlzLmtleU1hcCA9IHVuZGVmaW5lZDtcblx0dGhpcy5kZWJ1ZyA9IHt9O1xuXHR0aGlzLnByb3BzID0ge307XG5cblx0cGFwZXIuc2V0dXAodGhpcy5jYW52YXMpO1xuXHRcblx0dGhpcy5hdHRhY2hFdmVudHMoKTtcblx0dGhpcy5kcmF3KCk7XG5cblx0Ly8gcGFwZXIudmlldy56b29tID0gMC41O1xuXG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5hdHRhY2hFdmVudHMgPSBmdW5jdGlvbigpIHtcblxuXHQvLyB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcblx0Ly8gXHR0aGlzLm9uS2V5RG93bihlLmtleS50b0xvd2VyQ2FzZSgpLCBlLmxvY2F0aW9uKTtcblx0Ly8gXHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdC8vIH0uYmluZCh0aGlzKSk7XG5cblx0Ly8gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZSkge1xuXHQvLyBcdHRoaXMub25LZXlVcChlLmtleS50b0xvd2VyQ2FzZSgpLCBlLmxvY2F0aW9uKTtcblx0Ly8gXHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdC8vIH0uYmluZCh0aGlzKSk7XG5cblx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGZ1bmN0aW9uKGUpIHtcblx0XHR0aGlzLmRyYXcoKTtcblx0fS5iaW5kKHRoaXMpKTtcblxufVxuXG5LZXlib2FyZC5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uKCkge1xuXG5cdHBhcGVyLnByb2plY3QuYWN0aXZlTGF5ZXIucmVtb3ZlQ2hpbGRyZW4oKTtcblxuXHQvLyBWaWV3IHJlc2l6ZVxuXHR0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuXHR0aGlzLmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cdHRoaXMuY2FudmFzLnN0eWxlID0gJyc7XG5cdHBhcGVyLnZpZXcudmlld1NpemUgPSBuZXcgcGFwZXIuU2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTtcblxuXHQvLyBJbml0IFVJXG5cdHRoaXMua2V5Ym9hcmQgPSBuZXcgcGFwZXIuR3JvdXAoKTtcblx0dGhpcy5wYXRoID0gbmV3IHBhcGVyLlBhdGgoKTtcblx0dGhpcy5ncmFwaGljcyA9IG5ldyBwYXBlci5Hcm91cChbdGhpcy5rZXlib2FyZCwgdGhpcy5wYXRoXSk7XG5cdHRoaXMuZ3JhcGhpY3MuYnJpbmdUb0Zyb250KCk7XG5cblx0Ly8gRHJhdyBVSVxuXHR0aGlzLmRyYXdLZXlib2FyZCgpO1xuXG5cdC8vIFJlc3BvbnNpdmVcblx0dGhpcy5ncmFwaGljcy5wb3NpdGlvbiA9IHBhcGVyLnZpZXcuY2VudGVyO1xuXG5cdC8vIERlYnVnXG5cdHRoaXMuZGVidWcuY2VudGVyID0gbmV3IHBhcGVyLlNoYXBlLkNpcmNsZShuZXcgcGFwZXIuUG9pbnQoODAsIDUwKSwgMik7XG5cdHRoaXMuZGVidWcuY2VudGVyLmZpbGxDb2xvciA9IFwicmVkXCI7XG5cdHRoaXMuZGVidWcuYm91bmRpbmdCb3ggPSBuZXcgcGFwZXIuUGF0aC5SZWN0YW5nbGUodGhpcy5rZXlib2FyZC5ib3VuZHMpO1xuXHR0aGlzLmRlYnVnLmNlbnRlci5wb3NpdGlvbiA9IHBhcGVyLnZpZXcuY2VudGVyO1xuXHR0aGlzLmRlYnVnLmJvdW5kaW5nQm94LnBvc2l0aW9uID0gcGFwZXIudmlldy5jZW50ZXI7XG5cblx0cGFwZXIudmlldy5kcmF3KCk7XG5cbn1cblxuS2V5Ym9hcmQucHJvdG90eXBlLmRyYXdLZXlib2FyZCA9IGZ1bmN0aW9uKHByb3BzKSB7XG5cblx0Ly8gTUFETkVTU1xuXG5cdHZhciBrZXlib2FyZFdpZHRoID0gTWF0aC5yb3VuZChwYXBlci52aWV3LmJvdW5kcy53aWR0aCowLjkpO1xuXHR2YXIgbWFyZ2luID0gTWF0aC5yb3VuZChwYXBlci52aWV3LmJvdW5kcy53aWR0aCowLjAwNyk7XG5cdHZhciBrZXlTaXplID0gTWF0aC5yb3VuZCggKGtleWJvYXJkV2lkdGggLSAxMyptYXJnaW4pIC8gMTUuNSApO1xuXG5cdGNvbnNvbGUubG9nKG1hcmdpbik7XG5cdGNvbnNvbGUubG9nKGtleWJvYXJkV2lkdGgpO1xuXHRjb25zb2xlLmxvZyhrZXlTaXplKTtcblxuXHQvLyBEcmF3IGZpcnN0IGxpbmVcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCAxMzsgaSsrKSB7XG5cdFx0dmFyIHBhdGggPSBuZXcgcGFwZXIuUmVjdGFuZ2xlKG5ldyBwYXBlci5Qb2ludChpKihrZXlTaXplICsgbWFyZ2luKSwgMCksIGtleVNpemUpO1xuXHRcdHZhciBrZXkgPSBuZXcgcGFwZXIuUGF0aC5SZWN0YW5nbGUocGF0aCwgbmV3IHBhcGVyLlNpemUoNCwgNCkpO1xuXHRcdHRoaXMua2V5Ym9hcmQuYWRkQ2hpbGQoa2V5KTtcblx0fVxuXG5cdC8vIERlbCBrZXkgaXMgMS41eCB3aWRlciB0aGFuIGEgS2V5XG5cdHZhciBkZWwgPSBuZXcgcGFwZXIuUmVjdGFuZ2xlKG5ldyBwYXBlci5Qb2ludCgxMyooa2V5U2l6ZSArIG1hcmdpbiksIDApLCBuZXcgcGFwZXIuU2l6ZShrZXlTaXplKjEuNSwga2V5U2l6ZSkpO1xuXHR2YXIgZGVsS2V5ID0gbmV3IHBhcGVyLlBhdGguUmVjdGFuZ2xlKGRlbCwgbmV3IHBhcGVyLlNpemUoNCwgNCkpO1xuXHR0aGlzLmtleWJvYXJkLmFkZENoaWxkKGRlbEtleSk7XG5cblx0Ly8gVGFiIGtleSBpcyAxLjV4IHdpZGVyIHRoYW4gYSBLZXlcblx0dmFyIHRhYiA9IG5ldyBwYXBlci5SZWN0YW5nbGUobmV3IHBhcGVyLlBvaW50KDAsIGtleVNpemUgKyBtYXJnaW4pLCBuZXcgcGFwZXIuU2l6ZShrZXlTaXplKjEuNSwga2V5U2l6ZSkpO1xuXHR2YXIgdGFiS2V5ID0gbmV3IHBhcGVyLlBhdGguUmVjdGFuZ2xlKHRhYiwgbmV3IHBhcGVyLlNpemUoNCwgNCkpO1xuXHR0aGlzLmtleWJvYXJkLmFkZENoaWxkKHRhYktleSk7XG5cblx0Ly8gRHJhdyBzZWNvbmQgbGluZVxuXHRmb3IgKHZhciBpID0gMDsgaSA8IDEzOyBpKyspIHtcblx0XHR2YXIgcGF0aCA9IG5ldyBwYXBlci5SZWN0YW5nbGUobmV3IHBhcGVyLlBvaW50KGkqKGtleVNpemUgKyBtYXJnaW4pICsgdGFiS2V5LmJvdW5kcy53aWR0aCArIG1hcmdpbiwga2V5U2l6ZSArIG1hcmdpbiksIGtleVNpemUpO1xuXHRcdHZhciBrZXkgPSBuZXcgcGFwZXIuUGF0aC5SZWN0YW5nbGUocGF0aCwgbmV3IHBhcGVyLlNpemUoNCwgNCkpO1xuXHRcdHRoaXMua2V5Ym9hcmQuYWRkQ2hpbGQoa2V5KTtcblx0fVxuXG5cdC8vIENhcHNsb2NrIGtleSBpcyAxLjV4IHdpZGVyIHRoYW4gYSBLZXkgKyBtYXJnaW5cblx0dmFyIGNsID0gbmV3IHBhcGVyLlJlY3RhbmdsZShuZXcgcGFwZXIuUG9pbnQoMCwgKGtleVNpemUgKyBtYXJnaW4pICogMiksIG5ldyBwYXBlci5TaXplKGtleVNpemUqMS41ICsgbWFyZ2luLCBrZXlTaXplKSk7XG5cdHZhciBjbEtleSA9IG5ldyBwYXBlci5QYXRoLlJlY3RhbmdsZShjbCwgbmV3IHBhcGVyLlNpemUoNCwgNCkpO1xuXHR0aGlzLmtleWJvYXJkLmFkZENoaWxkKGNsS2V5KTtcblxuXHQvLyBEcmF3IHRoaXJkIGxpbmVcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCAxMTsgaSsrKSB7XG5cdFx0dmFyIHBhdGggPSBuZXcgcGFwZXIuUmVjdGFuZ2xlKG5ldyBwYXBlci5Qb2ludChpKihrZXlTaXplICsgbWFyZ2luKSArIGNsS2V5LmJvdW5kcy53aWR0aCArIG1hcmdpbiwgKGtleVNpemUgKyBtYXJnaW4pICogMiksIGtleVNpemUpO1xuXHRcdHZhciBrZXkgPSBuZXcgcGFwZXIuUGF0aC5SZWN0YW5nbGUocGF0aCwgbmV3IHBhcGVyLlNpemUoNCwgNCkpO1xuXHRcdHRoaXMua2V5Ym9hcmQuYWRkQ2hpbGQoa2V5KTtcblx0fVxuXG5cdC8vIFJldHVybiBrZXkgaXMgMnggd2lkZXIgdGhhbiBhIEtleVxuXHR2YXIgcnQgPSBuZXcgcGFwZXIuUmVjdGFuZ2xlKG5ldyBwYXBlci5Qb2ludCh0aGlzLmtleWJvYXJkLmxhc3RDaGlsZC5ib3VuZHMudG9wUmlnaHQueCArIG1hcmdpbiwgKGtleVNpemUgKyBtYXJnaW4pICogMiksIG5ldyBwYXBlci5TaXplKGtleVNpemUqMiwga2V5U2l6ZSkpO1xuXHR2YXIgcnRLZXkgPSBuZXcgcGFwZXIuUGF0aC5SZWN0YW5nbGUocnQsIG5ldyBwYXBlci5TaXplKDQsIDQpKTtcblx0dGhpcy5rZXlib2FyZC5hZGRDaGlsZChydEtleSk7XG5cblx0Ly8gU2hpZnQga2V5IGlzIDJ4IHdpZGVyIHRoYW4gYSBLZXkgKyAyIHggbWFyZ2luXG5cdHZhciBzaGlmdCA9IG5ldyBwYXBlci5SZWN0YW5nbGUobmV3IHBhcGVyLlBvaW50KDAsIChrZXlTaXplICsgbWFyZ2luKSAqIDMpLCBuZXcgcGFwZXIuU2l6ZShrZXlTaXplKjIgKyAyICogbWFyZ2luLCBrZXlTaXplKSk7XG5cdHZhciBzaGlmdEtleSA9IG5ldyBwYXBlci5QYXRoLlJlY3RhbmdsZShzaGlmdCwgbmV3IHBhcGVyLlNpemUoNCwgNCkpO1xuXHR0aGlzLmtleWJvYXJkLmFkZENoaWxkKHNoaWZ0S2V5KTtcblxuXHQvLyBEcmF3IGZvdXJ0aCBsaW5lXG5cdGZvciAodmFyIGkgPSAwOyBpIDwgMTA7IGkrKykge1xuXHRcdHZhciBwYXRoID0gbmV3IHBhcGVyLlJlY3RhbmdsZShuZXcgcGFwZXIuUG9pbnQoaSooa2V5U2l6ZSArIG1hcmdpbikgKyBzaGlmdEtleS5ib3VuZHMud2lkdGggKyBtYXJnaW4sIChrZXlTaXplICsgbWFyZ2luKSAqIDMpLCBrZXlTaXplKTtcblx0XHR2YXIga2V5ID0gbmV3IHBhcGVyLlBhdGguUmVjdGFuZ2xlKHBhdGgsIG5ldyBwYXBlci5TaXplKDQsIDQpKTtcblx0XHR0aGlzLmtleWJvYXJkLmFkZENoaWxkKGtleSk7XG5cdH1cblxuXHQvLyBTaGlmdCBrZXkgaXMgMnggd2lkZXIgdGhhbiBhIEtleSArIDIgeCBtYXJnaW5cblx0dmFyIHNoaWZ0MiA9IG5ldyBwYXBlci5SZWN0YW5nbGUobmV3IHBhcGVyLlBvaW50KHRoaXMua2V5Ym9hcmQubGFzdENoaWxkLmJvdW5kcy50b3BSaWdodC54ICsgbWFyZ2luLCAoa2V5U2l6ZSArIG1hcmdpbikgKiAzKSwgbmV3IHBhcGVyLlBvaW50KHJ0S2V5LmJvdW5kcy5ib3R0b21SaWdodC54LCBydEtleS5ib3VuZHMuYm90dG9tUmlnaHQueSArIG1hcmdpbiArIGtleVNpemUpKTtcblx0dmFyIHNoaWZ0MktleSA9IG5ldyBwYXBlci5QYXRoLlJlY3RhbmdsZShzaGlmdDIsIG5ldyBwYXBlci5TaXplKDQsIDQpKTtcblx0dGhpcy5rZXlib2FyZC5hZGRDaGlsZChzaGlmdDJLZXkpO1xuXG5cdC8vIEN0cmwxIGtleSBpcyAxLjV4IHdpZGVyIHRoYW4gYSBLZXlcblx0dmFyIGN0cmwxID0gbmV3IHBhcGVyLlJlY3RhbmdsZShuZXcgcGFwZXIuUG9pbnQoMCwgKGtleVNpemUgKyBtYXJnaW4pICogNCksIG5ldyBwYXBlci5TaXplKGtleVNpemUqMS41LCBrZXlTaXplKSk7XG5cdHZhciBjdHJsMUtleSA9IG5ldyBwYXBlci5QYXRoLlJlY3RhbmdsZShjdHJsMSwgbmV3IHBhcGVyLlNpemUoNCwgNCkpO1xuXHR0aGlzLmtleWJvYXJkLmFkZENoaWxkKGN0cmwxS2V5KTtcblxuXHQvLyBBbHQxIGtleSBpcyAxeCBrZXkgKyAxeCBtYXJnaW5cblx0dmFyIGFsdDEgPSBuZXcgcGFwZXIuUmVjdGFuZ2xlKG5ldyBwYXBlci5Qb2ludCgxLjUqa2V5U2l6ZSArIG1hcmdpbiwgKGtleVNpemUgKyBtYXJnaW4pICogNCksIG5ldyBwYXBlci5TaXplKGtleVNpemUgKyBtYXJnaW4sIGtleVNpemUpKTtcblx0dmFyIGFsdDFLZXkgPSBuZXcgcGFwZXIuUGF0aC5SZWN0YW5nbGUoYWx0MSwgbmV3IHBhcGVyLlNpemUoNCwgNCkpO1xuXHR0aGlzLmtleWJvYXJkLmFkZENoaWxkKGFsdDFLZXkpO1xuXG5cdC8vIENvbW1hbmQxIGtleSBpc1xuXHR2YXIgY21kMSA9IG5ldyBwYXBlci5SZWN0YW5nbGUobmV3IHBhcGVyLlBvaW50KHRoaXMua2V5Ym9hcmQubGFzdENoaWxkLmJvdW5kcy50b3BSaWdodC54ICsgbWFyZ2luLCAoa2V5U2l6ZSArIG1hcmdpbikgKiA0KSwgbmV3IHBhcGVyLlBvaW50KGtleVNpemUqNCArIG1hcmdpbio1IC0gbWFyZ2luLCAoa2V5U2l6ZSArIG1hcmdpbikgKiA0ICsga2V5U2l6ZSkpO1xuXHR2YXIgY21kMUtleSA9IG5ldyBwYXBlci5QYXRoLlJlY3RhbmdsZShjbWQxLCBuZXcgcGFwZXIuU2l6ZSg0LCA0KSk7XG5cdHRoaXMua2V5Ym9hcmQuYWRkQ2hpbGQoY21kMUtleSk7XG5cblx0Ly8gU3BhY2Uga2V5IGlzIDZ4IGtleSArIDV4IG1hcmdpblxuXHR2YXIgc3BhY2UgPSBuZXcgcGFwZXIuUmVjdGFuZ2xlKG5ldyBwYXBlci5Qb2ludCg0KmtleVNpemUgKyA1Km1hcmdpbiwgKGtleVNpemUgKyBtYXJnaW4pICogNCksIG5ldyBwYXBlci5TaXplKDYqa2V5U2l6ZSArIDUqbWFyZ2luLCBrZXlTaXplKSk7XG5cdHZhciBzcGFjZUtleSA9IG5ldyBwYXBlci5QYXRoLlJlY3RhbmdsZShzcGFjZSwgbmV3IHBhcGVyLlNpemUoNCwgNCkpO1xuXHR0aGlzLmtleWJvYXJkLmFkZENoaWxkKHNwYWNlS2V5KTtcblxuXG5cdHRoaXMua2V5Ym9hcmQuc3R5bGUgPSB7XG5cdFx0ZmlsbENvbG9yOiBcIiM4MDgwODBcIixcblx0XHRzdHJva2VDb2xvcjogbmV3IHBhcGVyLkNvbG9yKDEsMSwxLDAuNCksXG5cdFx0c3Ryb2tlV2lkdGg6IDEuMSxcblx0XHRzaGFkb3dDb2xvcjogbmV3IHBhcGVyLkNvbG9yKDAsMCwwLDAuNDUpLFxuXHRcdHNoYWRvd0JsdXI6IDQsXG5cdFx0c2hhZG93T2Zmc2V0OiBuZXcgcGFwZXIuUG9pbnQoMCwgMilcblx0fVxuXG59XG5cbi8vIEtleWJvYXJkLnByb3RvdHlwZS5pbml0S2V5Ym9hcmQgPSBmdW5jdGlvbihrZXlib2FyZCwgc3ZnKSB7XG5cbi8vIFx0Y29uc29sZS5sb2coJ0ltcG9ydGVkIScpO1xuXG4vLyBcdC8vIERlYnVnXG4vLyBcdHRoaXMuZGVidWcuY2VudGVyID0gbmV3IHBhcGVyLlNoYXBlLkNpcmNsZShuZXcgcGFwZXIuUG9pbnQoODAsIDUwKSwgMik7XG4vLyBcdHRoaXMuZGVidWcuY2VudGVyLmZpbGxDb2xvciA9IFwicmVkXCI7XG5cbi8vIFx0Ly8gS2V5Ym9hcmRcbi8vIFx0dGhpcy5rZXlib2FyZCA9IGtleWJvYXJkLmNoaWxkcmVuWzBdO1xuLy8gXHQvLyB0aGlzLmtleWJvYXJkLmFwcGx5TWF0cml4ID0gZmFsc2U7XG5cbi8vIFx0dGhpcy5rZXlib2FyZC5zdHlsZSA9IHtcbi8vIFx0XHRmaWxsQ29sb3I6IFwiIzgwODA4MFwiLFxuLy8gXHRcdHN0cm9rZUNvbG9yOiBuZXcgcGFwZXIuQ29sb3IoMSwxLDEsMC40KSxcbi8vIFx0XHRzdHJva2VXaWR0aDogMS41LFxuLy8gXHRcdHNoYWRvd0NvbG9yOiBuZXcgcGFwZXIuQ29sb3IoMCwwLDAsMC40NSksXG4vLyBcdFx0c2hhZG93Qmx1cjogNCxcbi8vIFx0XHRzaGFkb3dPZmZzZXQ6IG5ldyBwYXBlci5Qb2ludCgwLCAyKVxuLy8gXHR9XG5cbi8vIFx0Ly8gRGVidWdcbi8vIFx0dGhpcy5kZWJ1Zy5ib3VuZGluZ0JveCA9IG5ldyBwYXBlci5QYXRoLlJlY3RhbmdsZSh0aGlzLmtleWJvYXJkLmJvdW5kcyk7XG4vLyBcdC8vIHRoaXMuZGVidWcuYm91bmRpbmdCb3guc3Ryb2tlQ29sb3IgPSBcImJsdWVcIjtcblxuLy8gXHRmb3IgKHZhciBpID0gdGhpcy5rZXlib2FyZC5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuXHRcdFxuLy8gXHRcdC8vIFN0eWxlIGtleXMgaW5kaXZpZHVhbGx5XG5cbi8vIFx0XHR0aGlzLmtleWJvYXJkLmNoaWxkcmVuW2ldLnN0cm9rZUNvbG9yID0gbmV3IHBhcGVyLkNvbG9yKE1hdGgucmFuZG9tKCksIE1hdGgucmFuZG9tKCksIE1hdGgucmFuZG9tKCkpO1xuLy8gXHRcdHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baV0uc3Ryb2tlQ29sb3IgPSB7XG4vLyBcdFx0XHRncmFkaWVudDoge1xuLy8gXHRcdFx0XHRzdG9wczogW25ldyBwYXBlci5Db2xvcigxLDEsMSwwLjMpLCBuZXcgcGFwZXIuQ29sb3IoMSwxLDEsMC4yKV1cbi8vIFx0XHRcdH0sXG4vLyBcdFx0XHRvcmlnaW46IHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baV0uYm91bmRzLnRvcENlbnRlcixcbi8vIFx0XHRcdGRlc3RpbmF0aW9uOiB0aGlzLmtleWJvYXJkLmNoaWxkcmVuW2ldLmJvdW5kcy5ib3R0b21DZW50ZXJcbi8vIFx0XHR9XG5cbi8vIFx0fVxuXG4vLyBcdHRoaXMua2V5TWFwID0gW1xuLy8gXHRcdFwiMVwiLFxuLy8gXHRcdFwiYFwiLFxuLy8gXHRcdFwiMlwiLFxuLy8gXHRcdFwiM1wiLFxuLy8gXHRcdFwiNFwiLFxuLy8gXHRcdFwiNVwiLFxuLy8gXHRcdFwiNlwiLFxuLy8gXHRcdFwiN1wiLFxuLy8gXHRcdFwiOFwiLFxuLy8gXHRcdFwiOVwiLFxuLy8gXHRcdFwiMFwiLFxuLy8gXHRcdFwiLVwiLFxuLy8gXHRcdFwiPVwiLFxuLy8gXHRcdFwicVwiLFxuLy8gXHRcdFwid1wiLFxuLy8gXHRcdFwiZVwiLFxuLy8gXHRcdFwiclwiLFxuLy8gXHRcdFwidFwiLFxuLy8gXHRcdFwieVwiLFxuLy8gXHRcdFwidVwiLFxuLy8gXHRcdFwiaVwiLFxuLy8gXHRcdFwib1wiLFxuLy8gXHRcdFwicFwiLFxuLy8gXHRcdFwiW1wiLFxuLy8gXHRcdFwiXVwiLFxuLy8gXHRcdFwiXFxcXFwiLFxuLy8gXHRcdFwiYVwiLFxuLy8gXHRcdFwic1wiLFxuLy8gXHRcdFwiZFwiLFxuLy8gXHRcdFwiZlwiLFxuLy8gXHRcdFwiZ1wiLFxuLy8gXHRcdFwiaFwiLFxuLy8gXHRcdFwialwiLFxuLy8gXHRcdFwia1wiLFxuLy8gXHRcdFwibFwiLFxuLy8gXHRcdFwiO1wiLFxuLy8gXHRcdFwiJ1wiLFxuLy8gXHRcdFwielwiLFxuLy8gXHRcdFwieFwiLFxuLy8gXHRcdFwiY1wiLFxuLy8gXHRcdFwidlwiLFxuLy8gXHRcdFwiYlwiLFxuLy8gXHRcdFwiblwiLFxuLy8gXHRcdFwibVwiLFxuLy8gXHRcdFwiLFwiLFxuLy8gXHRcdFwiLlwiLFxuLy8gXHRcdFwiL1wiLFxuLy8gXHRcdFwiYmFja3NwYWNlXCIsXG4vLyBcdFx0XCJ0YWJcIixcbi8vIFx0XHRcImNhcHNsb2NrXCIsXG4vLyBcdFx0XCJzaGlmdFwiLCAvLyBMXG4vLyBcdFx0XCIgXCIsIC8vIFNwYWNlXG4vLyBcdFx0XCIvL21ldGFcIiwgLy8gUlxuLy8gXHRcdFwiY29udHJvbFwiLCAvLyBMXG4vLyBcdFx0XCIvL2FsdFwiLCAvLyBSXG4vLyBcdFx0XCJhbHRcIiwgLy8gTFxuLy8gXHRcdFwiLy9jb250cm9sXCIsIC8vIFJcbi8vIFx0XHRcIm1ldGFcIiwgLy8gTFxuLy8gXHRcdFwiLy9zaGlmdFwiLCAvLyBSXG4vLyBcdFx0XCJlbnRlclwiLFxuLy8gXHRdXG5cbi8vIFx0dmFyIHJldHVyblR5cGUgPSBuZXcgcGFwZXIuUmFzdGVyKCdyZXR1cm4nKTtcbi8vIFx0cmV0dXJuVHlwZS5wb3NpdGlvbi54ID0gdGhpcy5rZXlib2FyZC5jaGlsZHJlbls1OV0uYm91bmRzLmJvdHRvbVJpZ2h0LnggLSByZXR1cm5UeXBlLndpZHRoLzIgLSAxMjtcbi8vIFx0cmV0dXJuVHlwZS5wb3NpdGlvbi55ID0gdGhpcy5rZXlib2FyZC5jaGlsZHJlbls1OV0uYm91bmRzLmJvdHRvbVJpZ2h0LnkgLSByZXR1cm5UeXBlLmhlaWdodC8yIC0gMTI7XG5cbi8vIFx0dmFyIGRlbFR5cGUgPSBuZXcgcGFwZXIuUmFzdGVyKCdkZWwnKTtcbi8vIFx0ZGVsVHlwZS5wb3NpdGlvbi54ID0gdGhpcy5rZXlib2FyZC5jaGlsZHJlbls0N10uYm91bmRzLmJvdHRvbVJpZ2h0LnggLSBkZWxUeXBlLndpZHRoLzIgLSAxMjtcbi8vIFx0ZGVsVHlwZS5wb3NpdGlvbi55ID0gdGhpcy5rZXlib2FyZC5jaGlsZHJlbls0N10uYm91bmRzLmJvdHRvbVJpZ2h0LnkgLSBkZWxUeXBlLmhlaWdodC8yIC0gMTI7XG4vLyBcdC8vIHZhciByZXR1cm5UeXBlID0gbmV3IHBhcGVyLlBvaW50VGV4dChuZXcgcGFwZXIuUG9pbnQodGhpcy5rZXlib2FyZC5jaGlsZHJlbls1OV0uYm91bmRzLmJvdHRvbVJpZ2h0LnggLSAxMiwgdGhpcy5rZXlib2FyZC5jaGlsZHJlbls1OV0uYm91bmRzLmJvdHRvbVJpZ2h0LnkgLSAxMikpO1xuLy8gXHQvLyByZXR1cm5UeXBlLmp1c3RpZmljYXRpb24gPSAncmlnaHQnO1xuLy8gXHQvLyByZXR1cm5UeXBlLmZvbnRGYW1pbHk9ICdSb2JvdG8nO1xuXG4vLyBcdC8vIHJldHVyblR5cGUuZmlsbENvbG9yID0gJ3doaXRlJztcbi8vIFx0Ly8gcmV0dXJuVHlwZS5jb250ZW50ID0gJ3JldHVybic7XG5cbi8vIFx0Ly8gdmFyIGRlbFR5cGUgPSBuZXcgcGFwZXIuUG9pbnRUZXh0KG5ldyBwYXBlci5Qb2ludCh0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzQ3XS5ib3VuZHMuYm90dG9tUmlnaHQueCAtIDEyLCB0aGlzLmtleWJvYXJkLmNoaWxkcmVuWzQ3XS5ib3VuZHMuYm90dG9tUmlnaHQueSAtIDEyKSk7XG4vLyBcdC8vIGRlbFR5cGUuanVzdGlmaWNhdGlvbiA9ICdyaWdodCc7XG4vLyBcdC8vIGRlbFR5cGUuZm9udEZhbWlseT0gJ1JvYm90byc7XG5cbi8vIFx0Ly8gZGVsVHlwZS5maWxsQ29sb3IgPSAnd2hpdGUnO1xuLy8gXHQvLyBkZWxUeXBlLmNvbnRlbnQgPSAnZGVsJztcblxuLy8gXHR0aGlzLnR5cGUgPSBuZXcgcGFwZXIuR3JvdXAoW3JldHVyblR5cGUsIGRlbFR5cGVdKTtcblxuLy8gXHR0aGlzLmluaXRQYXRoKCk7XG4vLyBcdHRoaXMucmVzaXplKCk7XG5cbi8vIH1cblxuS2V5Ym9hcmQucHJvdG90eXBlLmluaXRQYXRoID0gZnVuY3Rpb24oKSB7XG5cblx0dGhpcy5wYXRoLnN0eWxlID0ge1xuXHRcdHN0cm9rZVdpZHRoIDogNixcblx0XHRmaWxsQ29sb3I6IG5ldyBwYXBlci5Db2xvcigwLDAsMCwwKSxcblx0XHRzdHJva2VDYXAgOiAncm91bmQnLFxuXHRcdHN0cm9rZUpvaW4gOiAncm91bmQnXG5cdH1cblxuXHR0aGlzLnBhdGguc3Ryb2tlQ29sb3IgPSB7XG5cdFx0Z3JhZGllbnQ6IHtcblx0XHRcdHN0b3BzOiBbbmV3IHBhcGVyLkNvbG9yKCcjMDBGRkY0JyksIG5ldyBwYXBlci5Db2xvcignIzFGMDBGRicpXVxuXHRcdH0sXG5cdFx0b3JpZ2luOiB0aGlzLmRlYnVnLmJvdW5kaW5nQm94LmJvdW5kcy5sZWZ0Q2VudGVyLFxuXHRcdGRlc3RpbmF0aW9uOiB0aGlzLmRlYnVnLmJvdW5kaW5nQm94LmJvdW5kcy5yaWdodENlbnRlclxuXHR9XG5cblx0dGhpcy5ncmFwaGljcyA9IG5ldyBwYXBlci5Hcm91cChbdGhpcy5rZXlib2FyZCwgdGhpcy5wYXRoXSk7XG5cdHRoaXMuZ3JhcGhpY3MuYnJpbmdUb0Zyb250KCk7XG5cbn1cblxuS2V5Ym9hcmQucHJvdG90eXBlLmxvY2F0ZUtleSA9IGZ1bmN0aW9uKGtleSwgbG9jYXRpb24pIHtcblxuXHR2YXIgaW5kZXggPSBudWxsXG5cblx0aWYobG9jYXRpb24gPT0gMSB8fCBsb2NhdGlvbiA9PSAwKSB7XG5cblx0XHQvLyBMZWZ0IHNpZGVcblx0XHRcblx0XHRmb3IgKHZhciBpID0gdGhpcy5rZXlNYXAubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcblx0XHRcdGlmKHRoaXMua2V5TWFwW2ldID09IGtleSkgaW5kZXggPSBpO1xuXHRcdH1cblxuXHRcdGlmKGluZGV4ID09IG51bGwpIHtcblx0XHRcdGNvbnNvbGUubG9nKCdObyBtYXRjaCcpO1xuXHRcdH1cblxuXHR9XG5cdGVsc2UgaWYobG9jYXRpb24gPT0gMikge1xuXG5cdFx0Ly8gUmlnaHQgc2lkZVxuXG5cdFx0aWYoa2V5ID09IFwibWV0YVwiKSB7XG5cdFx0XHRpbmRleCA9IDUyO1xuXHRcdH1cblxuXHRcdGlmKGtleSA9PSBcImFsdFwiKSB7XG5cdFx0XHRpbmRleCA9IDU0O1xuXHRcdH1cblxuXHRcdGlmKGtleSA9PSBcImNvbnRyb2xcIikge1xuXHRcdFx0aW5kZXggPSA1Njtcblx0XHR9XG5cblx0XHRpZihrZXkgPT0gXCJzaGlmdFwiKSB7XG5cdFx0XHRpbmRleCA9IDU4O1xuXHRcdH1cblxuXHR9XG5cblx0cmV0dXJuIGluZGV4O1xuXG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5vbktleURvd24gPSBmdW5jdGlvbihrZXksIGxvY2F0aW9uKSB7XG5cblx0dmFyIGluZGV4ID0gdGhpcy5sb2NhdGVLZXkoa2V5LCBsb2NhdGlvbik7XG5cblx0dGhpcy5rZXlib2FyZC5jaGlsZHJlbltpbmRleF0uc2hhZG93Q29sb3IgPSBuZXcgcGFwZXIuQ29sb3IoMCwwLDAsMC4yKTtcblx0dGhpcy5rZXlib2FyZC5jaGlsZHJlbltpbmRleF0uc2hhZG93Qmx1ciA9IDE7XG5cdHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baW5kZXhdLnNoYWRvd09mZnNldCA9IG5ldyBwYXBlci5Qb2ludCgwLCAxKTtcblxuXHRpZihrZXkgPT0gXCJiYWNrc3BhY2VcIikge1xuXHRcdHRoaXMuZGVsZXRlKCk7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0aWYoa2V5ID09IFwiZW50ZXJcIikge1xuXHRcdHBhcGVyLnZpZXcuZHJhdygpO1xuXHRcdHJldHVybjtcblx0fVxuXG5cdHRoaXMuYWRkVG9UZXh0KGtleSk7XG5cdHRoaXMuYWRkVG9QYXRoKGluZGV4KTtcblxufVxuXG5LZXlib2FyZC5wcm90b3R5cGUub25LZXlVcCA9IGZ1bmN0aW9uKGtleSwgbG9jYXRpb24pIHtcblxuXHRmb3IgKHZhciBpID0gdGhpcy5rZXlib2FyZC5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuXHRcdFxuXHRcdHRoaXMua2V5Ym9hcmQuY2hpbGRyZW5baV0uc2hhZG93Q29sb3IgPSBuZXcgcGFwZXIuQ29sb3IoMCwwLDAsMC40NSk7XG5cdFx0dGhpcy5rZXlib2FyZC5jaGlsZHJlbltpXS5zaGFkb3dCbHVyID0gNDtcblx0XHR0aGlzLmtleWJvYXJkLmNoaWxkcmVuW2ldLnNoYWRvd09mZnNldCA9IG5ldyBwYXBlci5Qb2ludCgwLCAyKTtcblxuXHR9XG5cblx0aWYoa2V5ID09IFwiZW50ZXJcIikge1xuXHRcdGlmKHRoaXMucGF0aC5zZWdtZW50cy5sZW5ndGggPiAxKSB7XG5cdFx0XHR0aGlzLnNlbmRUb1ByaW50ZXIoKTtcblx0XHRcdHRoaXMucmVzZXRBbGwoKTtcblx0XHR9XG5cdH1cblxuXHRwYXBlci52aWV3LmRyYXcoKTtcbn1cblxuS2V5Ym9hcmQucHJvdG90eXBlLmFkZFRvUGF0aCA9IGZ1bmN0aW9uKGluZGV4KSB7XG5cblx0dGhpcy5wYXRoLmFkZCh0aGlzLmtleWJvYXJkLmNoaWxkcmVuW2luZGV4XS5ib3VuZHMuY2VudGVyKTtcblx0dGhpcy5wYXRoLnNtb290aCgpO1xuXG5cdHBhcGVyLnZpZXcuZHJhdygpO1xuXG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5hZGRUb1RleHQgPSBmdW5jdGlvbihjaGFyYWN0ZXIpIHtcblxuXHR0aGlzLnRleHQucHVzaChjaGFyYWN0ZXIpO1xuXG59XG5cbktleWJvYXJkLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbigpIHtcblxuXHR0aGlzLnBhdGgucmVtb3ZlU2VnbWVudCh0aGlzLnBhdGguc2VnbWVudHMubGVuZ3RoLTEpO1xuXHR0aGlzLnRleHQucG9wKCk7XG5cblx0cGFwZXIudmlldy5kcmF3KCk7XG5cbn1cblxuS2V5Ym9hcmQucHJvdG90eXBlLnNlbmRUb1ByaW50ZXIgPSBmdW5jdGlvbigpIHtcblxuXHQvLyBGb3JtYXQgdGV4dCBmb3IgZXhwb3J0aW5nXG5cdGZvciAodmFyIGkgPSB0aGlzLnRleHQubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcblx0XHRpZih0aGlzLnRleHRbaV0gPT0gJ21ldGEnIHx8IHRoaXMudGV4dFtpXSA9PSAnY29udHJvbCcgfHwgdGhpcy50ZXh0W2ldID09ICdhbHQnIHx8IHRoaXMudGV4dFtpXSA9PSAnc2hpZnQnIHx8IHRoaXMudGV4dFtpXSA9PSAndGFiJyB8fCB0aGlzLnRleHRbaV0gPT0gJ2NhcHNsb2NrJykge1xuXHRcdFx0dGhpcy50ZXh0W2ldID0gJ+KWkSc7XG5cdFx0fVxuXHR9XG5cblx0Ly8gRm9ybWF0IHN2ZyBmb3Igc2F2aW5nXG5cdHZhciBzdmcgPSAnPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwidXRmLThcIj8+Jztcblx0c3ZnICs9ICc8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIiB4PVwiMHB4XCIgeT1cIjBweFwiIHdpZHRoPVwiJyArIHBhcGVyLnZpZXcuYm91bmRzLndpZHRoICsgJ1wiIGhlaWdodD1cIicgKyBwYXBlci52aWV3LmJvdW5kcy5oZWlnaHQgKyAnXCI+Jztcblx0c3ZnICs9IHRoaXMucGF0aC5leHBvcnRTVkcoeyBhc1N0cmluZzogdHJ1ZSB9KTtcblx0c3ZnICs9ICc8L3N2Zz4nO1xuXG5cdHZhciBibG9iID0gbmV3IEJsb2IoW3N2Z10sIHtcblx0XHR0eXBlOiAnZGF0YTppbWFnZS9zdmcreG1sJ1xuXHR9KTtcblxuXHRzYXZlQXMoYmxvYiwgdGhpcy50ZXh0LmpvaW4oJycpICsgJy5zdmcnKTtcblxufVxuXG5LZXlib2FyZC5wcm90b3R5cGUucmVzZXRBbGwgPSBmdW5jdGlvbigpIHtcblxuXHR0aGlzLnBhdGgucmVtb3ZlU2VnbWVudHMoKTtcblx0dGhpcy50ZXh0ID0gW107XG5cbn0iLCJ2YXIgTG9hZGVyID0ge1xuXG5cdHF1ZXVlIDogdW5kZWZpbmVkLFxuXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXMucXVldWUgPSBuZXcgY3JlYXRlanMuTG9hZFF1ZXVlKCk7XG5cdFx0dGhpcy5xdWV1ZS5vbignY29tcGxldGUnLCB0aGlzLm9uTG9hZENvbXBsZXRlZCk7XG5cdFx0dGhpcy5xdWV1ZS5vbignZXJyb3InLCB0aGlzLm9uTG9hZEVycm9yKTtcblx0XHR0aGlzLnF1ZXVlLm9uKCdwcm9ncmVzcycsIHRoaXMub25Mb2FkUHJvZ3Jlc3MpO1xuXHR9LFxuXG5cdGxvYWQ6IGZ1bmN0aW9uKG1hbmlmZXN0LCBvbkxvYWRlZCkge1xuXHRcdGNvbnNvbGUubG9nKCdMb2FkaW5nOicsIG1hbmlmZXN0WzBdLnNyYyk7XG5cdFx0dmFyIHEgPSB0aGlzLnF1ZXVlO1xuXHRcdHEub24oJ2NvbXBsZXRlJywgb25Mb2FkZWQpO1xuXHRcdHEubG9hZE1hbmlmZXN0KG1hbmlmZXN0KTtcblx0fSxcblxuXHRnZXRDb250ZW50QnlJZDogZnVuY3Rpb24oaWQpIHtcblx0XHRyZXR1cm4gdGhpcy5xdWV1ZS5nZXRSZXN1bHQoaWQpO1xuXHR9LFxuXG5cdG9uTG9hZENvbXBsZXRlZDogZnVuY3Rpb24oKSB7XG5cdFx0Y29uc29sZS5sb2coJ0xvYWQgQ29tcGxldGVkJyk7XG5cdH0sXG5cblx0b25Mb2FkRXJyb3I6IGZ1bmN0aW9uKCkge1xuXHRcdGNvbnNvbGUubG9nKCdMb2FkIEVycm9yJyk7XG5cdH0sXG5cblx0b25Mb2FkUHJvZ3Jlc3M6IGZ1bmN0aW9uKCkge1xuXHRcdGNvbnNvbGUubG9nKCcuJyk7XG5cdH0sXG5cdFxufTsiLCJ2YXIgQXBwID0ge1xuXG5cdGNvbnRhaW5lcjogdW5kZWZpbmVkLFxuXG5cdGluaXQ6IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuXHRcdHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuXHRcdExvYWRlci5pbml0KCk7XG5cdFx0dGhpcy5pbml0aWFsTG9hZCgpO1xuXHR9LFxuXG5cdGluaXRpYWxMb2FkOiBmdW5jdGlvbigpIHtcblx0XHRMb2FkZXIubG9hZChbXG5cdFx0XHR7aWQ6ICdob21lcGFnZScsIHNyYzogJ2RhdGEvaG9tZXBhZ2UuaHRtbCd9XG5cdFx0XSwgdGhpcy5sb2FkQ29tcGxldGVkLmJpbmQodGhpcykpOyAvLyBCaW5kaW5nIGFsbG93cyB0byBrZWVwIHRoZSBBcHAgc2NvcGUgb24gY2FsbGJhY2tcblx0fSxcblxuXHRsb2FkQ29tcGxldGVkOiBmdW5jdGlvbigpIHtcblx0XHR0aGlzLmNvbnRhaW5lci5pbm5lckhUTUwgPSBMb2FkZXIuZ2V0Q29udGVudEJ5SWQoJ2hvbWVwYWdlJyk7XG5cdFx0dGhpcy5pbml0aWFsVHJhbnNpdGlvbkluKCk7XG5cdH0sXG5cblx0aW5pdGlhbFRyYW5zaXRpb25JbjogZnVuY3Rpb24oKSB7XG5cdFx0dGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnZmFkZS1pbicpO1xuXHRcdGNvbnNvbGUubG9nKCdbUEFOXSDimJHvuI8nKTtcblx0XHRLZXlib2FyZCA9IG5ldyBLZXlib2FyZCgpO1xuXHR9LFxuXG5cdGRpc3Bvc2U6IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXMuY29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xuXHR9XG5cbn07IiwiZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgZnVuY3Rpb24oKSB7XG5cblx0Y29uc29sZS5sb2coJ/CfkbsnKTtcblx0QXBwLmluaXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhaW5lcicpKTtcblxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
